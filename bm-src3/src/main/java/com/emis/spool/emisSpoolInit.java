package com.emis.spool;import com.emis.trace.emisTracer;import javax.servlet.ServletContext;/** * this class is used for init spool size * 最主要是因為機器剛開機時,Application Server 和 Database Server * 開啟的時間先後不固定,所以用另一個 Thread 來連接資料庫 * 直到連線數達到 Spool 設定的最小值 * * @see com.emis.spool.emisComplexSpool */public class emisSpoolInit implements Runnable {  private emisComplexSpool oSpool_;  private ServletContext oContext_;  public emisSpoolInit(ServletContext oContext,emisComplexSpool oSpool) {    oContext_ = oContext;    oSpool_ = oSpool;  }  public void run() {      int nInitSize = oSpool_.getInitSize();      while( oSpool_.totalSize() < nInitSize ) {        try {          oSpool_.getSpoolObjectFromSource(false);        } catch (Exception ignore) {          try {            emisTracer.get(oContext_).warning(this,ignore.getMessage());            Thread.currentThread().sleep(15 * 1000);          } catch (InterruptedException e) {}        }      }      // 標識為初始化完成      oSpool_.bInitReady_ = true;  }    public void handrun() {      int nInitSize = oSpool_.getInitSize();      while( oSpool_.totalSize() < nInitSize ) {        try {          oSpool_.getSpoolObjectFromSource(false);        } catch (Exception ignore) {          try {            emisTracer.get(oContext_).warning(this,ignore.getMessage());            Thread.currentThread().sleep(15 * 1000);          } catch (InterruptedException e) {}        }      }  } }