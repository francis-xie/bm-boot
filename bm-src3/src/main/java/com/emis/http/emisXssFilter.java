package com.emis.http;import java.io.IOException;import javax.servlet.Filter;import javax.servlet.FilterChain;import javax.servlet.FilterConfig;import javax.servlet.ServletException;import javax.servlet.ServletRequest;import javax.servlet.ServletResponse;import javax.servlet.http.*;import java.util.*;/* web.xml中添加使用范例:  <filter>    <filter-name>xssFilter</filter-name>    <filter-class>com.emis.http.emisXssFilter</filter-class>    <init-param>      <param-name>encoding</param-name>      <param-value>UTF-8</param-value>    </init-param>  </filter>  <filter-mapping>    <filter-name>xssFilter</filter-name>    <url-pattern>/*</url-pattern>  </filter-mapping> *//** * Servlet Filter implementation class SqlEscapeFilter */public class emisXssFilter implements Filter {  private String encoding = null;  /**   * Default constructor.   */  public emisXssFilter() {    // TODO Auto-generated constructor stub  }  /**   * @see Filter#destroy()   */  public void destroy() {    // TODO Auto-generated method stub  }  /**   * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain)   */  public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {    request.setCharacterEncoding(getEncoding());    String url = ((HttpServletRequest) request).getRequestURI().toLowerCase();    if (url.endsWith("/emis_upload.jsp")) {      chain.doFilter(request, response);      return;    }    HttpServletRequest hreq = (HttpServletRequest) request;    Map map = hreq.getParameterMap();    Iterator itr = map.keySet().iterator();    while (itr.hasNext()) {      String key = itr.next().toString();      String[] values = hreq.getParameterValues(key);      if (values != null) {        for (int i = 0; i < values.length; i++) {          values[i] = cleanXSS(values[i]);        }      }      hreq.setAttribute(key, values);    }    // pass the request along the filter chain    chain.doFilter(request, response);  }  /**   * @see Filter#init(FilterConfig)   */  public void init(FilterConfig fConfig) throws ServletException {    // TODO Auto-generated method stub    this.encoding = fConfig.getInitParameter("encoding");    if (this.encoding == null || "".equals(this.encoding.trim())) {      this.encoding = "UTF-8";    }  }  private String getEncoding() {    return this.encoding;  }  private String cleanXSS(String value) {    value = value.replaceAll("<", "&lt;").replaceAll(">", "&gt;");    value = value.replaceAll("\\(", "&#40;").replaceAll("\\)", "&#41;");    value = value.replaceAll("'", "&#39;");    value = value.replaceAll("eval\\((.*)\\)", "");    value = value.replaceAll("[\\\"\\\'][\\s]*javascript:(.*)[\\\"\\\']", "\"\"");    value = value.replaceAll("script", "");    return value;  }}