package com.emis.taglibs.showdata;import com.emis.file.emisFileMgr;import com.emis.trace.emisMessage;import com.emis.trace.emisTracer;import javax.servlet.ServletContext;import javax.servlet.jsp.JspWriter;import javax.servlet.jsp.tagext.TagSupport;import java.io.IOException;/** * Title: * Description: * Copyright:    Copyright (c) 2001 * Company: * @author * @version 1.0 * lisa.huang 2010/05/07 新增顯示全部按鈕 */public class emisDataBrowser extends TagSupport{  private StringBuffer oJScript_ = new StringBuffer(1024);  private JspWriter out_ ;  private String sId_;  private String sSource_;  public int doStartTag() {    try {      String _sTableId = "idTBL" ;      sId_ = "idbrowser";      sSource_ = "xmlData";      String _sClickid = "idRow" ;      emisTracer _oTrace;      ServletContext _oContext = pageContext.getServletContext();      _oTrace = emisTracer.get(_oContext);      String _sImageRoot = emisFileMgr.getInstance(_oContext).getDirectory("images").getRelative();      out_ = pageContext.getOut();      String _sGenTable = (String) pageContext.getAttribute("GENTABLE") ;      if (! "Y".equals( _sGenTable )){        writeTableDef(_sTableId , _sClickid );        pageContext.setAttribute("GENTABLE" , "Y" ) ;      }      StringBuffer _oBuf = new StringBuffer(256);      if (_sImageRoot == null) _sImageRoot = "/images/";      String _sFirstRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_FIRSTREC);      String _sPrevRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_PREVREC);      String _sNextRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_NEXTREC);      String _sLastRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_LASTREC);      String _sListCul = "全部";      String _sMoveFR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVEFIRSTREC);      String _sMovePR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVEPREVREC);      String _sMoveNR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVENEXTREC);      String _sMoveLR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVELASTREC);      _oBuf.append("<span id='idNavigator'>");      _oBuf.append("<IMG id=\"" + _sTableId + "BrowFirstRec\" value=\"" + _sFirstRec + "\" alt=\"" + _sFirstRec + "\" src=\"").append(_sImageRoot).append("firstrec.gif\" border=\"0\" onclick=\"emisIdbrowserMove('" + sId_ + "'," + sSource_ + ".recordset,1); \" TITLE=\"" + _sMoveFR + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "BrowPrevRec\"  value=\"" + _sPrevRec + "\" alt=\"" + _sPrevRec + "\" src=\"").append(_sImageRoot).append("prevrec.gif\"  border=\"0\" onclick=\"emisIdbrowserMove('" + sId_ + "'," + sSource_ + ".recordset,2); \" TITLE=\"" + _sMovePR + "\" style=\"cursor:hand\">\n");//      _oBuf.append("<IMG id=\"" + _sTableId + "BrowListCul\"  value=\"" + _sListCul + "\" alt=\"" + _sListCul + "\" src=\"").append(_sImageRoot).append("ListCul.gif\"  border=\"0\" onclick=\"emisIdbrowserMove('" + sId_ + "'," + sSource_ + ".recordset,5); \" TITLE=\"" + "顯示全部" + "\" style=\"cursor:hand;\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "BrowNextRec\"  value=\"" + _sNextRec + "\" alt=\"" + _sNextRec + "\" src=\"").append(_sImageRoot).append("nextrec.gif\"  border=\"0\" onclick=\"emisIdbrowserMove('" + sId_ + "'," + sSource_ + ".recordset,3); \" TITLE=\"" + _sMoveNR + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "BrowLastRec\"  value=\"" + _sLastRec + "\" alt=\"" + _sLastRec + "\" src=\"").append(_sImageRoot).append("lastrec.gif\"  border=\"0\" onclick=\"emisIdbrowserMove('" + sId_ + "'," + sSource_ + ".recordset,4); \" TITLE=\"" + _sMoveLR + "\" style=\"cursor:hand\">\n");      _oBuf.append("</span>");      writeln(_oBuf.toString());      if (this.oJScript_.length() > 0) {        writeln(this.oJScript_.toString());      }    } catch(Exception e){      System.out.println("DataBrowserError");    }    return(SKIP_BODY);  }  private void writeTableDef(String sTableId , String sClickEventId) throws Exception {    genTableJavaScript(sTableId);    if (sClickEventId != null) {      genTableClickEvent(sClickEventId);    }  }  private void genTableClickEvent(String sClickId) throws Exception {    oJScript_.append("<script for=" + sClickId + " event=onclick>\n");    oJScript_.append("  emisOnidRowClick(this,idTBLRec);\n");    oJScript_.append("</script>");  }  private void genTableJavaScript(String sId) {    oJScript_.append("<script for=\"" + sId + "\" event=onreadystatechange>\n");    oJScript_.append("  emisOnTableReadyStateChange(idTBLRec);\n");    oJScript_.append("  </script>\n");  }  private void writeln(String sStr) throws IOException {    out_.write(sStr);    out_.write("\n");  }  public String getid() {    return sId_;  }  public void setid(String sId) {    this.sId_ = sId;  }  public String getsource() {    return sSource_;  }  public void setsource(String sSource) {    this.sSource_ = sSource;  }}