<?xml version="1.0" encoding="UTF-8" ?>
<xml>
  <!--$Id: migration.xml 14718 2019-06-11 08:29:16Z andy.he $
    #41294 update by Andy 配合控菜系统需求调整:
      1.增加postType属性，可设定下载的机台类型(对应CASH_ID.POS_TYPE)，如未设定该属性则只会产生档案给CASH.POS_TYPE为空或等于V的机台。
      2.收银机类型(POS_TYPE)：V或空-一般收银端，I-财务端，S-控菜端，C-厨房端，Q-叫号取餐端
  -->

  <!--会员卡等级资料下传add by jshon.liu 2013/10/29-->
  <migration name="CARD_V_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select CARD_NO,CARD_NAME,CARD_DTYPE,CARD_DISC,CARD_PNTAMT,CARD_POINT,CARD_EXG,CARD_EXGAMT,REMARK from CARD_V
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CARD_V."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="CARD_NO"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_NAME"/><target length="25"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DTYPE"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DISC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_PNTAMT"/><target type="Dec" format="###0.00" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_POINT"/><target type="Dec" format="#####0" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXG"/><target type="Dec" format="#####0" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXGAMT"/><target type="Dec" format="###0.00" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--会员基本资料add by jshon.liu 2013/12/14-->
  <migration name="CUST_V_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @key nvarchar(50)
        select @key=[VALUE] from EMISPROP where [NAME]='PASS'

        select  c.C_NO,dbo.eposGetCC_NAME(@key,C_NAME) AS C_NAME,
        CARD_DTYPE,100-CARD_DISC as CARD_DISC,dbo.eposGetCC_NAME(@key,C_MOB) AS C_MOB,
        c.C_POINT+isnull(ba.SUM_POINT,0) as C_POINT,dbo.eposGetCC_NAME(@key,C_BIRTH) AS C_BIRTH,isnull(c.C_BIRTH_FLAG,0) as C_BIRTH_FLAG,
        CARD_PNTAMT,CARD_POINT,CARD_EXG,CARD_EXGAMT,c.CC_NO,C_STATUS,c.CARD_NO,cd.CC_STATUS,
        dbo.eposGetCC_NAME(@key,C_ADDR1) AS C_ADDR1,isnull(d.MAX_CARD_POINT,0) MAX_CARD_POINT,cvs.S_NO from Cust_V c
        inner join card_V d on c.CARD_NO=d.CARD_NO
        inner join CUST_V_STORE cvs on c.C_NO=cvs.C_NO
        left join CUST_V_CRD cd on c.C_NO=cd.C_NO and c.CC_NO=cd.CC_NO
        left join (select C_NO1,C_NO2,isnull(sum(PU_POINT),0) SUM_POINT from POINT_V_UPD where FLS_NO='ED'
        and isnull(SL_KEY,'')!='' group by C_NO1,C_NO2 ) ba on ba.C_NO1=c.C_NO and ba.C_NO2=c.C_NO
        order by cvs.S_NO,c.C_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CUST_V."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="C_NO"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NAME"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_POINT"/><target type="Dec" format="###0" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DTYPE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DISC"/><target type="Dec" format="###0.00" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_MOB"/><target length="13" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_ADDR1"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_PNTAMT"/><target type="Dec" format="###0.00" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_POINT"/><target type="Dec" format="###0" length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXG"/><target type="Dec" format="###0" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXGAMT"/><target type="Dec" format="###0.00" length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_STATUS"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CC_NO"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CC_STATUS"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_NO"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_BIRTH"/><target length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_BIRTH_FLAG"/><target type="Dec" format="###0" length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MAX_CARD_POINT"/><target type="Dec" format="###0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--会员异动资料add by jshon.liu 2013/12/14-->
  <migration name="ADD_CUST_V_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @key nvarchar(50)
        select @key=[VALUE] from EMISPROP where [NAME]='PASS'

        select  c.C_NO,dbo.eposGetCC_NAME(@key,C_NAME) AS C_NAME,
        CARD_DTYPE,100-CARD_DISC as CARD_DISC,dbo.eposGetCC_NAME(@key,C_MOB) AS C_MOB,
        c.C_POINT+isnull(ba.SUM_POINT,0) as C_POINT,dbo.eposGetCC_NAME(@key,C_BIRTH) AS C_BIRTH,isnull(c.C_BIRTH_FLAG,0) as C_BIRTH_FLAG,
        CARD_PNTAMT,CARD_POINT,CARD_EXG,CARD_EXGAMT,c.CC_NO,C_STATUS,c.CARD_NO,cd.CC_STATUS,
        dbo.eposGetCC_NAME(@key,C_ADDR1) AS C_ADDR1,cvs.S_NO from Cust_V c
        inner join card_V d on c.CARD_NO=d.CARD_NO
        inner join CUST_V_STORE cvs on c.C_NO=cvs.C_NO
        left join CUST_V_CRD cd on c.C_NO=cd.C_NO and c.CC_NO=cd.CC_NO
        left join (select C_NO1,C_NO2,isnull(sum(PU_POINT),0) SUM_POINT from POINT_V_UPD where FLS_NO='ED'
        and isnull(SL_KEY,'')!='' group by C_NO1,C_NO2 ) ba
        on ba.C_NO1=c.C_NO and ba.C_NO2=c.C_NO
        where 3>=datediff(day,c.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,c.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        or 3>=datediff(day,d.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,cd.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        order by cvs.S_NO,c.C_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CUST_V."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="C_NO"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NAME"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_POINT"/><target type="Dec" format="###0" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DTYPE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_DISC"/><target type="Dec" format="###0.00" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_MOB"/><target length="13" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_ADDR1"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_PNTAMT"/><target type="Dec" format="###0.00" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_POINT"/><target type="Dec" format="###0" length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXG"/><target type="Dec" format="###0" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_EXGAMT"/><target type="Dec" format="###0.00" length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_STATUS"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CC_NO"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CC_STATUS"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_NO"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_BIRTH"/><target length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_BIRTH_FLAG"/><target type="Dec" format="###0" length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--客订关联门店下传-->
  <migration name="S_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @IS_STORE varchar(2)
        select @IS_STORE= [VALUE] from EMISPROP where [NAME]='EP_IS_STORE_CONTROL'
        declare @IS_IWILL varchar(2)
        select @IS_IWILL= [VALUE] from EMISPROP where [NAME]='IS_IWILL'

        if isnull(@IS_STORE,'N')='N'
        begin
          select S_NO as S_NO_T,'STORE' as T_NO ,'' as S_NO,'' as S_NAME,0 as TD_SEQ,'Y' as USERD
          from store
          where S_STATUS != '2'
          union all
          select s1.S_NO as S_NO_T,'STORE' as T_NO,s2.S_NO,s2.S_NAME,0 as TD_SEQ,'Y' as USERD
          from STORE s1
          cross join (select S_NO,S_NAME from STORE where S_STATUS!='2' and (isnull(@IS_IWILL,'')!='Y' or R_NO not in ('8991','8992'))) s2
          where s1.S_STATUS != '2'  and (isnull(@IS_IWILL,'')!='Y' or s1.R_NO not in ('8991','8992'))
        order by 1,3
        end
        else
        begin
          select S_NO as S_NO_T, 'STORE' as T_NO ,'' as S_NO,'' as S_NAME,0 as TD_SEQ,'Y' as USERD
          from store
          where S_STATUS != '2'
          union all
          select s.S_NO as S_NO_T, 'STORE' as T_NO,sg.S_NO,sg.S_NAME,0 as TD_SEQ,'Y' as USERD
          from STORE s
          cross join (select sg.S_NO,sg.SG_NO,s.S_NAME from STORE_GD_DATA sg
          left join STORE s on sg.S_NO=s.S_NO and s.S_STATUS != '2' and (isnull(@IS_IWILL,'')!='Y' or s.R_NO not in ('8991','8992'))) sg
          where sg.SG_NO in(select SG_NO from store_gd_data where S_NO=s.S_NO) and s.S_STATUS != '2'
          and (isnull(@IS_IWILL,'')!='Y' or s.R_NO not in ('8991','8992'))
          order by 1,3
        end
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_T"/>
    <data><source name="T_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><source name="S_NO_T"/></data>
  </migration>

  <!--客层资料下传 add by cherry-->
  <migration name="TAB_CL_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO,TD_NO,TD_NAME,TD_SEQ,'Y' as USERD
        from Tab_d where T_NO='CL_NO' order by TD_SEQ
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CL_NO."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
  </migration>

  <!--天气资料下传 add by cherry-->
  <migration name="WEA_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO,TD_NO,TD_NAME,TD_SEQ,'Y' as USERD
        from Tab_d where T_NO='WEA' order by TD_SEQ
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="WEA." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
  </migration>

  <!--员工资料 CASHIER VENUS-->
  <migration name="CASHIER_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @sIS_OP_LEVEL nvarchar(2)
        select  @sIS_OP_LEVEL = isnull(max([value]),'N') from emisProp where name='EP_IS_OP_LEVEL'
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD
        , case c.OP_LEVEL when '1' then '0' when '2' then '1' when '3' then '2' when '4' then 'SUPPORT' else c.OP_LEVEL end as OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        , case when isnull(c.CAL_SP_D,'') = '' or  convert(nvarchar(8),dbo.GetLocalDate(),112) >= c.CAL_SP_D then 'Y' else 'N' end CAL_SP
        , c.IS_SENDER
		from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where 'N' = @sIS_OP_LEVEL and c.OP_STATUS = '1'
        union all
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD, c.OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        , case when isnull(c.CAL_SP_D,'') = '' or  convert(nvarchar(8),dbo.GetLocalDate(),112) >= c.CAL_SP_D then 'Y' else 'N' end CAL_SP
        , c.IS_SENDER
		from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where 'Y' = @sIS_OP_LEVEL and c.OP_STATUS = '1'
        order by 1,2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CASHIER." posType="VIS"
      timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PASSWORD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_LEVEL"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CSHER_CARD"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_DWN"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_ACC"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_HR"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_SALER"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CAL_SP"/><target length="1"/></data>
	<data><target value="@@@" length="3"/></data>
    <data><source name="IS_SENDER"/><target length="2"/></data>
  </migration>

  <!--员工资料异动档 ADD_CASHIER VENUS-->
  <migration name="ADD_CASHIER_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @sIS_OP_LEVEL nvarchar(2)
        select  @sIS_OP_LEVEL = isnull(max([value]),'N') from emisProp where name='EP_IS_OP_LEVEL'
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD
        , case c.OP_LEVEL when '1' then '0' when '2' then '1' when '3' then '2' when '4' then 'SUPPORT' else c.OP_LEVEL end as OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        , case when isnull(c.CAL_SP_D,'') = '' or  convert(nvarchar(8),dbo.GetLocalDate(),112) >= c.CAL_SP_D then 'Y' else 'N' end CAL_SP
        , c.IS_SENDER
		from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where (3>=datediff(day,c.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,c.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) )
          and 'N' = @sIS_OP_LEVEL and OP_STATUS = '1'
        union all
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD, c.OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        , case when isnull(c.CAL_SP_D,'') = '' or  convert(nvarchar(8),dbo.GetLocalDate(),112) >= c.CAL_SP_D then 'Y' else 'N' end CAL_SP
        , c.IS_SENDER
		from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where (3>=datediff(day,c.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,c.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
          and 'Y' = @sIS_OP_LEVEL and OP_STATUS = '1'
        order by 1,2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CASHIER." posType="VIS"
      timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PASSWORD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_LEVEL"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CSHER_CARD"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_DWN"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_ACC"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_HR"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_SALER"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CAL_SP"/><target length="1"/></data>
	<data><target value="@@@" length="3"/></data>
    <data><source name="IS_SENDER"/><target length="2"/></data>
  </migration>

  <!--员工资料 UPD_CASHIER VENUS ，只下传最近1分钟的异动资料 call in emisICDutyInitDecorator-->
  <migration name="UPD_CASHIER_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @sIS_OP_LEVEL nvarchar(2)
        select  @sIS_OP_LEVEL = isnull(max([value]),'N') from emisProp where name='EP_IS_OP_LEVEL'
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD
        , case c.OP_LEVEL when '1' then '0' when '2' then '1' when '3' then '2' when '4' then 'SUPPORT' else c.OP_LEVEL end as OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where c.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) and c.UPD_TIME >= dbo.emisTime(dateadd(mi, -5, dbo.GetLocalDate()), '')
          and 'N' = @sIS_OP_LEVEL and OP_STATUS = '1'
        union all
        select c.S_NO, c.OP_NO, c.OP_NAME, c.OP_SEX, c.OP_TEL1, c.OP_TEL2, c.OP_ADDR1, c.OP_ADDR2
        , c.OP_ID, c.OP_BIRTH, c.OP_PASSWORD, c.OP_LEVEL
        , c.OP_STATUS, c.CSHER_CARD, c.OP_DWN, c.IS_ACC, c.IS_HR
        , case when se.SA_NO = c.OP_NO then 'Y' else 'N' end as IS_SALER
        from Cashier c
        left join Saler se on se.SA_NO = c.OP_NO
        where c.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) and c.UPD_TIME >= dbo.emisTime(dateadd(mi, -5, dbo.GetLocalDate()), '')
          and 'Y' = @sIS_OP_LEVEL and OP_STATUS = '1'
        order by 1,2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CASHIER."
      timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PASSWORD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_LEVEL"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CSHER_CARD"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_DWN"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_ACC"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_HR"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_SALER"/><target length="1"/></data>
  </migration>

  <!--产品部门 DEPART Venus-->
  <migration name="DEPART_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, D_NO, [GROUP] as SUBDEP, D_CNAME, Isnull(D_ENAME,'') as D_ENAME
        , d.USED, row_number() over(order by D_NO) as SEQ_NO, SEA_NO, UN_NO, SALE_OPT,DP_TYPE,d.D_NO_OD
        ,d.D_OVERTIME
        from Depart d
        cross join (select S_NO from store where isnull(MU_NO,'') = '' ) s
        where D_DOWN = 'Y'
        union all
        select s.S_NO, d.D_NO, [GROUP] as SUBDEP, D_CNAME, Isnull(D_ENAME,'') as D_ENAME
        , d.USED, s.RECNO as SEQ_NO, SEA_NO, UN_NO, SALE_OPT,DP_TYPE,d.D_NO_OD
        ,d.D_OVERTIME
        from Depart d
        inner join (
        select S_NO, pd.D_NO, pd.RECNO
        from store s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        where ph.FLS_NO = 'Y' and exists(
          select MU_NO from PART_MENU_DD pdd
          where pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
          and (isnull(pdd.UP_DATE,'') = '' or Convert(nvarchar(8),dbo.GetLocalDate(),112) >= pdd.UP_DATE)
          and (isnull(pdd.DOWN_DATE,'') = '' or pdd.DOWN_DATE >= Convert(nvarchar(8),dbo.GetLocalDate(),112))
          )
          ) s on s.D_NO = d.D_NO and d.D_DOWN = 'Y'
        order by s.S_NO, SEQ_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DEPART." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUBDEP"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_CNAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_ENAME"/><target padding=" " align="right" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target padding=" " length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <!--<data><source name="RPT_NO"/><target padding=" " length="2"/></data>-->
    <!--<data><target value="@@@" length="3"/></data>-->
    <data><source name="UN_NO"/><target padding=" " length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SALE_OPT"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
    <data><source name="DP_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO_OD"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_OVERTIME"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--產品中分類(機台)-->
  <migration name="DEPART_ID_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, D_NO, [GROUP] as SUBDEP, D_CNAME, Isnull(D_ENAME,'') as D_ENAME
        , d.USED, row_number() over(order by D_NO) as SEQ_NO, SEA_NO, UN_NO, SALE_OPT,DP_TYPE,d.D_NO_OD,'' AS MU_NO,'' AS ID_NO
        from Depart d
        cross join (select S_NO from store where isnull(MU_NO,'') = '' ) s
        where D_DOWN = 'Y'
        union all
        select s.S_NO, d.D_NO, [GROUP] as SUBDEP, D_CNAME, Isnull(D_ENAME,'') as D_ENAME
        , d.USED, s.RECNO as SEQ_NO, SEA_NO, UN_NO, SALE_OPT,DP_TYPE,d.D_NO_OD,s.MU_NO,s.ID_NO
        from Depart d
        inner join (
        select S_NO, pd.D_NO, pd.RECNO,s.MU_NO,s.ID_NO
        from CASH_ID s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        where ph.FLS_NO = 'Y'
        ) s on s.D_NO = d.D_NO
        order by s.S_NO,s.ID_NO ,SEQ_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTargetIdNo" prefix="DEPART."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRuleIdNo" creationkey="S_NO,ID_NO"/>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUBDEP"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_CNAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_ENAME"/><target padding=" " align="right" length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target padding=" " length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <!--<data><source name="RPT_NO"/><target padding=" " length="2"/></data>-->
    <!--<data><target value="@@@" length="3"/></data>-->
    <data><source name="UN_NO"/><target padding=" " length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SALE_OPT"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
    <data><source name="DP_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO_OD"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/></data>
  </migration>

  <!--产品名称档 PART_H Venus-->
  <!--SQL中的?条件是S900手动执行时传入的选择的门店条件（这样手动执行一家门店时可以提升查询的效能），当系统排程执行时会填入1=1-->
  <migration name="PART_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@S900_REQ_SNO,@S900_REQ_SNO">
      <SQL>
        select s.S_NO, ph.P_NO_S,ph.P_NAME_S,ph.USED,ph.D_NO
        ,ph.SEA_NO,ph.P_TYPE,row_number() over (partition by S_NO, D_NO order by P_NO_S) as SEQ_NO, 'Y' as FLAG,ph.PRINT_LABLE
        ,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
        select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
            , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE,'0' as P_TYPE,dd.DISP_FLAG
          from Ddepart dd
          inner join Depart d on dd.D_NO = d.D_NO
          where d.D_DOWN = 'Y'
          Union All
          select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
            ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
            ,h.SM_DP_NO D_NO,'' SEA_NO, 'N' as PRINT_LABLE, '1' as P_TYPE,'12' as DISP_FLAG
          from Smenu_h h
          where FLS_NO!='ED'
        )ph
        cross join (select S_NO from vCCRStores s where ? and S_STATUS = '1' and isnull(MU_NO,'') = '' ) s
        union all
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO,/* s.SEA_NO*/
        case when s.SEA_NO = '' then (case when ph.SEA_NO='' then ph.sea_no2 else ph.SEA_NO end) else s.SEA_NO end as SEA_NO
        , ph.P_TYPE,s.RECNO as SEQ_NO, 'Y' as FLAG , ph.PRINT_LABLE ,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
          select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
            , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO,isnull(d.SEA_NO,'') as SEA_NO2, dd.PRINT_LABLE,'0' as P_TYPE ,dd.DISP_FLAG
          from Ddepart dd
          inner join Depart d on dd.D_NO = d.D_NO
          where d.D_DOWN = 'Y'
          Union All
          select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
            ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
            ,h.SM_DP_NO D_NO,'' SEA_NO,'' SEA_NO2 , 'N' as PRINT_LABLE, '1' as P_TYPE ,'12' as DISP_FLAG
          from Smenu_h h
          where FLS_NO!='ED'
        )ph
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, isnull(pdd.SEA_NO,'') as SEA_NO
        from vCCRStores s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        where ? and s.S_STATUS = '1' and ph.FLS_NO = 'Y'
          and (isnull(pdd.UP_DATE,'') = '' or Convert(nvarchar(8),dbo.GetLocalDate(),112) >= pdd.UP_DATE)
          and (isnull(pdd.DOWN_DATE,'') = '' or pdd.DOWN_DATE >= Convert(nvarchar(8),dbo.GetLocalDate(),112))
        ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
        order by S_NO, ph.D_NO, SEQ_NO, P_NO_S
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_H." posType="VS"
      timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="40" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <!--<data><source name="RPT_NO"/><target length="2"/></data>-->
    <!--<data><target value="@@@" length="3"/></data>-->
    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRINT_LABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISP_FLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

    <!--產品名稱檔（機台）-->
    <migration name="PART_H_ID_NO_VENUS">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO, /* s.SEA_NO*/
                 case when s.SEA_NO = '' then ph.SEA_NO else s.SEA_NO end as SEA_NO
                , ph.P_TYPE,s.RECNO as SEQ_NO, 'Y' as FLAG , ph.PRINT_LABLE,s.ID_NO,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
                from (
                select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
                , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE,'0' as P_TYPE,dd.DISP_FLAG
                from Ddepart dd
                inner join Depart d on dd.D_NO = d.D_NO
                where d.D_DOWN = 'Y'
                Union All
                select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
                ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
                ,h.SM_DP_NO D_NO,'' SEA_NO, 'N' as PRINT_LABLE, '1' as P_TYPE,'12' as DISP_FLAG
                from Smenu_h h
                where FLS_NO!='ED'
                )ph
                inner join (
                select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, isnull(pdd.SEA_NO,'') as SEA_NO,s.ID_NO
                from CASH_ID s
                inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
                inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
                inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
                where ph.FLS_NO = 'Y'
                ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
                order by S_NO,ID_NO, ph.D_NO, SEQ_NO, P_NO_S
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTargetIdNo" prefix="PART_H."
                  timestamp="yyyyMMddHHmmsss"   ext="ADD.DAT" path="@\data\download" Clear="true"
                  creationrule="com.emis.app.migration.ePosGroupCreationRuleIdNo" creationkey="S_NO,ID_NO"/>
        <data><source name="P_NO_S"/><target  length="13"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="P_NAME_S"/><target length="40" autosize="true"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="USED"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SEQ_NO"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="D_NO"/><target  length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="P_TYPE"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="FLAG"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="PRINT_LABLE"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DISP_FLAG"/><target length="10"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="S_NO"/></data>
        <data><source name="ID_NO"/></data>
    </migration>

  <!--产品明细 PART_D Venus-->
  <!--SQL中的?条件是S900手动执行时传入的选择的门店条件（这样手动执行一家门店时可以提升查询的效能），当系统排程执行时会填入1=1-->
  <migration name="PART_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@S900_REQ_SNO,@S900_REQ_SNO,@S900_REQ_SNO,@S900_REQ_SNO">
      <SQL>
          DECLARE @EP_DOWN_P_NAME NVARCHAR(2)
          SELECT @EP_DOWN_P_NAME = VALUE FROM EMISPROP WHERE NAME = 'EP_DOWN_P_NAME'

        select s.S_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from(
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, p.IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR
		    , p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3'
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO
        , 'Y' as IS_POR,'' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Smenu_h
        where FLS_NO !='ED'
        ) p cross join (select S_NO from vCCRStores s where ? and isnull(MU_NO,'') = '' ) s
        union all
        select s.S_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE else p.P_PRICE end P_PRICE
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from (
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, p.IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR
		    , p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3'
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO
        , 'Y' as IS_POR,'' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Smenu_h
        where FLS_NO !='ED'
        ) p
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pp.P_NO, pp.SP_PRICE_USERD, pp.SP_PRICE,
        pp.SP_PRICE2, pp.SP_PRICE3, pp.SP_PRICE4, pp.SP_PRICE5, pp.SP_PRICE6
        from vCCRStores s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        inner join PART_MENU_P pp on pp.MU_NO = pdd.MU_NO and pp.D_NO = pdd.D_NO and pp.DD_NO = pdd.DD_NO
        where ? and ph.FLS_NO = 'Y'
          and (isnull(pdd.UP_DATE,'') = '' or Convert(nvarchar(8),dbo.GetLocalDate(),112) >= pdd.UP_DATE)
          and (isnull(pdd.DOWN_DATE,'') = '' or pdd.DOWN_DATE >= Convert(nvarchar(8),dbo.GetLocalDate(),112))
        --and not exists (select P_NO from Sp_price where P_NO = pp.P_NO and S_NO = s.S_NO)
        ) s on s.DD_NO = p.P_NO_S and s.P_NO = p.P_NO

        union
        select sp.S_NO, sp.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, '' as P_DC, p.UN_NO as CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO
        , p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Sp_price sp
        inner join Part p on p.P_NO = sp.P_NO
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        inner join vCCRStores s on s.S_NO = sp.S_NO
        where ? and d.D_DOWN = 'Y' and isnull(s.MU_NO,'') = '' and p.P_STATUS != '3'
        union all
        select sp.S_NO, SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, '' as IS_WEIGH, '' AS P_DC, '' as CUN_NO, '' as P_EAN
        , '' as STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, '' AS P_PY, '' AS P_PHOTO,'Y' as IS_POR,'' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Sp_price sp
        inner join Smenu_h h on h.SM_NO = sp.P_NO
        inner join vCCRStores s on s.S_NO = sp.S_NO
        where ? and FLS_NO !='ED' and isnull(s.MU_NO,'') = ''
        order by 1, 2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_POR"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PS_QTY"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NEW_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
	  <data><source name="P_IN_UN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
	  <data><source name="DISABLE_SEA_ITEM_NO"/><target length="500" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--產品明細檔(機台)-->
  <migration name="PART_D_ID_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        DECLARE @EP_DOWN_P_NAME NVARCHAR(2)
        SELECT @EP_DOWN_P_NAME = VALUE FROM EMISPROP WHERE NAME = 'EP_DOWN_P_NAME'
        select s.S_NO, s.MU_NO, s.ID_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE else p.P_PRICE end P_PRICE
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO
        from (
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, p.IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3'
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO
        from Smenu_h
        where FLS_NO !='ED'
        ) p
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pp.P_NO, pp.SP_PRICE_USERD, pp.SP_PRICE,
        pp.SP_PRICE2, pp.SP_PRICE3, pp.SP_PRICE4, pp.SP_PRICE5, pp.SP_PRICE6,s.MU_NO,s.ID_NO
        from CASH_ID s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        inner join PART_MENU_P pp on pp.MU_NO = pdd.MU_NO and pp.D_NO = pdd.D_NO and pp.DD_NO = pdd.DD_NO
        where ph.FLS_NO = 'Y'
        ) s on s.DD_NO = p.P_NO_S and s.P_NO = p.P_NO

        union
        select sp.S_NO, '' AS MU_NO, '' AS ID_NO, sp.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, '' as P_DC, p.UN_NO as CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO
        from Sp_price sp
        inner join Part p on p.P_NO = sp.P_NO
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        inner join Store s on s.S_NO = sp.S_NO
        where d.D_DOWN = 'Y' and isnull(s.MU_NO,'') = '' and p.P_STATUS != '3'
        union all
        select sp.S_NO, '' AS MU_NO, '' AS ID_NO, SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, '' as IS_WEIGH, '' AS P_DC, '' as CUN_NO, '' as P_EAN
        , '' as STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, '' AS P_PY, '' AS P_PHOTO
        from Sp_price sp
        inner join Smenu_h h on h.SM_NO = sp.P_NO
        inner join Store s on s.S_NO = sp.S_NO
        where FLS_NO !='ED' and isnull(s.MU_NO,'') = ''
        order by s.S_NO, s.ID_NO,p.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTargetIdNo" prefix="PART_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRuleIdNo" creationkey="S_NO,ID_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
    <data><source name="ID_NO"/></data>
  </migration>

  <!--产品名称档-异动 PART_H Venus-->
  <!--SQL中的?条件是S900手动执行时传入的选择的门店条件（这样手动执行一家门店时可以提升查询的效能），当系统排程执行时会填入1=1-->
  <migration name="ADD_PART_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@S900_REQ_SNO,@S900_REQ_SNO">
      <SQL>
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO, /* s.SEA_NO*/
        ph.SEA_NO
        , ph.PRINT_LABLE, ph.P_TYPE, row_number() over (partition by S_NO, D_NO order by P_NO_S) as SEQ_NO, 'Y' as FLAG
        , isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
        select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
        , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE, '0' as P_TYPE, dd.CRE_DATE, dd.UPD_DATE,dd.DISP_FLAG,d.UPD_DATE as UPD_DATE1
        from Ddepart dd
        inner join Depart d on dd.D_NO = d.D_NO
        where (3>=datediff(day,dd.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,dd.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
        Union All
        select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
        ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
        ,h.SM_DP_NO D_NO,'' SEA_NO,'N' as PRINT_LABLE, '1' as P_TYPE, h.CRE_DATE, h.UPD_DATE ,'12' as DISP_FLAG,'' as UPD_DATE1
        from Smenu_h h
        where FLS_NO!='ED' and (3>=datediff(day,h.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,h.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
        )ph
        cross join (select S_NO from vCCRStores s where ? and S_STATUS = '1' and isnull(MU_NO,'') = '' ) s
        union all
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO, /* s.SEA_NO*/
          case when s.SEA_NO = '' then (case when ph.SEA_NO='' then ph.SEA_NO2 else ph.SEA_NO end) else s.SEA_NO end as SEA_NO
        , ph.PRINT_LABLE, ph.P_TYPE, s.RECNO as SEQ_NO, 'Y' as FLAG ,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
          select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
            , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO,isnull(d.SEA_NO,'') as SEA_NO2, dd.PRINT_LABLE, '0' as P_TYPE, dd.CRE_DATE, dd.UPD_DATE ,dd.DISP_FLAG,d.UPD_DATE as UPD_DATE1
          from Ddepart dd
          inner join Depart d on dd.D_NO = d.D_NO
          where d.D_DOWN = 'Y'
          Union All
          select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
            ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
            ,h.SM_DP_NO D_NO,'' SEA_NO,'' SEA_NO2,'N' as PRINT_LABLE, '1' as P_TYPE, h.CRE_DATE, h.UPD_DATE,'12' as DISP_FLAG,'' as UPD_DATE1
          from Smenu_h h
          where FLS_NO!='ED'
        )ph
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pdd.UPD_DATE, isnull(pdd.SEA_NO,'') as SEA_NO
        from vCCRStores s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        where ? and s.S_STATUS = '1' and ph.FLS_NO = 'Y'
          and (isnull(pdd.UP_DATE,'') = '' or Convert(nvarchar(8),dbo.GetLocalDate(),112) >= pdd.UP_DATE)
          and (isnull(pdd.DOWN_DATE,'') = '' or pdd.DOWN_DATE >= Convert(nvarchar(8),dbo.GetLocalDate(),112))
        ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
        where (3>=datediff(day,ph.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,ph.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,s.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,ph.UPD_DATE1,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) )
        order by S_NO, ph.D_NO, SEQ_NO, P_NO_S
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_H." posType="VS"
      timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="40" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <!--<data><source name="RPT_NO"/><target length="2"/></data>-->
    <!--<data><target value="@@@" length="3"/></data>-->
    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRINT_LABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISP_FLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

  <!--产品名称档-异动 PART_H Venus(機台)-->
  <migration name="ADD_PART_H_ID_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO, /* s.SEA_NO*/
        case when s.SEA_NO = '' then ph.SEA_NO else s.SEA_NO end as SEA_NO
        , ph.PRINT_LABLE, ph.P_TYPE, s.RECNO as SEQ_NO, 'Y' as FLAG ,s.MU_NO,s.ID_NO,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
        select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
        , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE, '0' as P_TYPE, dd.CRE_DATE, dd.UPD_DATE,dd.DISP_FLAG
        from Ddepart dd
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y'
        Union All
        select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
        ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
        ,h.SM_DP_NO D_NO,'' SEA_NO,'N' as PRINT_LABLE, '1' as P_TYPE, h.CRE_DATE, h.UPD_DATE,'12' as DISP_FLAG
        from Smenu_h h
        where FLS_NO!='ED'
        )ph
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pdd.UPD_DATE, isnull(pdd.SEA_NO,'') as SEA_NO,
        s.MU_NO,s.ID_NO
        from CASH_ID s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        where ph.FLS_NO = 'Y'
        ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
        where (ph.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or ph.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or s.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        order by S_NO,s.ID_NO, ph.D_NO, SEQ_NO, P_NO_S
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTargetIdNo" prefix="PART_H."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRuleIdNo" creationkey="S_NO,ID_NO"/>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="40" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <!--<data><source name="RPT_NO"/><target length="2"/></data>-->
    <!--<data><target value="@@@" length="3"/></data>-->
    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRINT_LABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISP_FLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
    <data><source name="ID_NO"/></data>
  </migration>

  <!--产品明细-异动 PART_D Venus-->
  <!--SQL中的?条件是S900手动执行时传入的选择的门店条件（这样手动执行一家门店时可以提升查询的效能），当系统排程执行时会填入1=1-->
  <migration name="ADD_PART_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@S900_REQ_SNO,@S900_REQ_SNO,@S900_REQ_SNO,@S900_REQ_SNO">
      <SQL>
        DECLARE @EP_DOWN_P_NAME NVARCHAR(2)
        SELECT @EP_DOWN_P_NAME = VALUE FROM EMISPROP WHERE NAME = 'EP_DOWN_P_NAME'
        select s.S_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from(
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, p.IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR
		    , p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3' and (3>=datediff(day,p.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,p.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) )
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO,'Y' as IS_POR
		    , '' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Smenu_h
        where FLS_NO !='ED' and (3>=datediff(day,CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) )
        ) p
        cross join (select S_NO from vCCRStores s where ? and isnull(MU_NO,'') = '' ) s
        union all
        select s.S_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE else p.P_PRICE end P_PRICE
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG,p.IS_WEIGH,p.P_DC,p.CUN_NO,p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1,p.P_NO_OD,p.REM_CODE,dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from (
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME,p.IS_WEIGH,p.P_DC,p.UN_NO as CUN_NO,p.P_EAN,p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO,p.IS_POR
		    , p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3'
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO,'Y' as IS_POR
		    , '' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Smenu_h
        where FLS_NO !='ED'
        ) p
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pp.P_NO, pp.SP_PRICE_USERD, pp.SP_PRICE,
        pp.SP_PRICE2, pp.SP_PRICE3, pp.SP_PRICE4, pp.SP_PRICE5, pp.SP_PRICE6
        from vCCRStores s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        inner join PART_MENU_P pp on pp.MU_NO = pdd.MU_NO and pp.D_NO = pdd.D_NO and pp.DD_NO = pdd.DD_NO
        where ? and ph.FLS_NO = 'Y' and 3>=datediff(day,pp.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        and (isnull(pdd.UP_DATE,'') = '' or Convert(nvarchar(8),dbo.GetLocalDate(),112) >= pdd.UP_DATE)
        and (isnull(pdd.DOWN_DATE,'') = '' or pdd.DOWN_DATE >= Convert(nvarchar(8),dbo.GetLocalDate(),112))
        --and not exists (select P_NO from Sp_price where P_NO = pp.P_NO and S_NO = s.S_NO)
        ) s on s.DD_NO = p.P_NO_S and s.P_NO = p.P_NO

        union
        select sp.S_NO, sp.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, '' as P_DC, p.UN_NO as CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY
		    , p.P_PHOTO,p.IS_POR,p.P_PS_QTY,p.P_NEW_DATE,p.P_IN_UN,p.DISABLE_SEA_ITEM_NO
        from Sp_price sp
        inner join Part p on p.P_NO = sp.P_NO
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        inner join vCCRStores s on s.S_NO = sp.S_NO
        where ? and d.D_DOWN = 'Y' and p.P_STATUS != '3' and isnull(s.MU_NO,'') = '' and (3>=datediff(day,sp.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        or 3>=datediff(day,sp.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,p.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        or 3>=datediff(day,p.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
        union all
        select sp.S_NO, SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, '' as IS_WEIGH, '' AS P_DC, '' as CUN_NO, '' as P_EAN
        , '' as STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, '' AS P_PY, '' AS P_PHOTO,'Y' as IS_POR,'' as P_PS_QTY,'' as P_NEW_DATE,'' as P_IN_UN,'' as DISABLE_SEA_ITEM_NO
        from Sp_price sp
        inner join Smenu_h h on h.SM_NO = sp.P_NO
        inner join vCCRStores s on s.S_NO = sp.S_NO
        where ? and FLS_NO !='ED' and isnull(s.MU_NO,'') = '' and (3>=datediff(day,sp.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        or 3>=datediff(day,sp.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,h.CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112))
        or 3>=datediff(day,h.UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
        order by 1, 2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_POR"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PS_QTY"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NEW_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
	  <data><source name="P_IN_UN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
	  <data><source name="DISABLE_SEA_ITEM_NO"/><target length="500" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>
  <!--产品明细-异动 PART_D Venus(機台)-->
  <migration name="ADD_PART_D_ID_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        DECLARE @EP_DOWN_P_NAME NVARCHAR(2)
        SELECT @EP_DOWN_P_NAME = VALUE FROM EMISPROP WHERE NAME = 'EP_DOWN_P_NAME'
        select s.S_NO, s.MU_NO, s.ID_NO, p.P_NO, p.P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE else p.P_PRICE end P_PRICE
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when s.SP_PRICE_USERD = 'Y' then s.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO
        from (
        select p.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, p.IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, p.STORAGE_LIFE
        , p.P_NO_OD, p.REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN
        , CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO
        from Part p
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3'
        union all
        select SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO
        from Smenu_h
        where FLS_NO !='ED'
        ) p
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pp.P_NO, pp.SP_PRICE_USERD, pp.SP_PRICE,
        pp.SP_PRICE2, pp.SP_PRICE3, pp.SP_PRICE4, pp.SP_PRICE5, pp.SP_PRICE6,s.MU_NO,s.ID_NO
        from CASH_ID s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        inner join PART_MENU_P pp on pp.MU_NO = pdd.MU_NO and pp.D_NO = pdd.D_NO and pp.DD_NO = pdd.DD_NO
        where ph.FLS_NO = 'Y' and pp.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112)
        ) s on s.DD_NO = p.P_NO_S and s.P_NO = p.P_NO

        union
        select sp.S_NO, '' AS MU_NO, '' AS ID_NO, sp.P_NO, p.DD_NO as P_NO_S, p.P_NAME
        , case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, '' as P_DC, p.UN_NO as CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, CASE @EP_DOWN_P_NAME WHEN '1' THEN p.P_NAME_S else p.P_NAME end P_NAME_S, p.P_PY, p.P_PHOTO
        from Sp_price sp
        inner join Part p on p.P_NO = sp.P_NO
        inner join Ddepart dd on dd.DD_NO = p.DD_NO
        inner join Depart d on dd.D_NO = d.D_NO
        inner join Store s on s.S_NO = sp.S_NO
        where d.D_DOWN = 'Y' and p.P_STATUS != '3' and isnull(s.MU_NO,'') = '' and (sp.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112)
        or sp.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or p.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112)
        or p.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        union all
        select sp.S_NO, '' AS MU_NO, '' AS ID_NO, SM_NO as P_NO, SM_NO as P_NO_S, SM_NAME as P_NAME
        , case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, sp.P_PRICE, sp.P_PRICE2, sp.P_PRICE3, sp.P_PRICE4, sp.P_PRICE5, sp.P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, '' as IS_WEIGH, '' AS P_DC, '' as CUN_NO, '' as P_EAN
        , '' as STORAGE_LIFE_1, '' P_NO_OD, '' REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX,0 AS PRICE_MIN, '' AS P_NAME_S, '' AS P_PY, '' AS P_PHOTO
        from Sp_price sp
        inner join Smenu_h h on h.SM_NO = sp.P_NO
        inner join Store s on s.S_NO = sp.S_NO
        where FLS_NO !='ED' and isnull(s.MU_NO,'') = '' and (sp.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112)
        or sp.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or h.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112)
        or h.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        order by s.S_NO, s.ID_NO,p.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTargetIdNo" prefix="PART_D."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRuleIdNo" creationkey="S_NO,ID_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
    <data><source name="ID_NO"/></data>
  </migration>

  <!--单位 UN_NO Venus-->
  <migration name="UN_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'UN_NO' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from Systab_d where T_NO = 'P_DEFC'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="UN_NO." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--  商品国际条码档  -->
  <migration name="PART_N_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select p.P_EAN, p.P_NO, p.P_IS_EAN, 'Y' as ADD_FLAG
        from Part_n p
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_N."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="P_EAN"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_IS_EAN"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADD_FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--折扣原因档 DISC_RESON Venus-->
  <migration name="DISC_RESON_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'DISC_RESON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from TAB_D where T_NO = 'DISC_RESON'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DISC_RESON."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--前台作废订单原因档 DEL_BILL_RESON Venus-->
  <migration name="DEL_BILL_RESON_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'DEL_BILL_RESON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from TAB_D where T_NO = 'DEL_BILL_RESON'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DEL_BILL_RESON."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--前台销售退货原因档 BACK_RESON Venus-->
  <migration name="BACK_RESON_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'BACK_RESON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from TAB_D where T_NO = 'BACK_RESON'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="BACK_RESON."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--调味加料表头 SEASONING_H Venus-->
  <migration name="SEASONING_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select SEA_NO, SEA_NAME, SEA_TYPE, IS_SINGLE, USED
        , row_number() over (order by SEA_NO) as SEQ_NO
        from Seasoning_h where USED = 'Y'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SEASONING_H." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="SEA_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NAME"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_SINGLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--调味加料表身 SEASONING_D Venus-->
  <migration name="SEASONING_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select SEA_ITEM_NO, SEA_NO, SEA_ITEM_NAME, DEF_CHOOSE, PRICE, PRICE2, PRICE3, USED
        , row_number() over (order by SEA_NO, SEA_ITEM_NO) as SEQ_NO,SEA_ITEM_NO_OD,SEA_REM_CODE
        from Seasoning_d where USED = 'Y'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SEASONING_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="SEA_ITEM_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_ITEM_NAME"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_CHOOSE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE2"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE3"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_ITEM_NO_OD"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_REM_CODE"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--成套群组讯息 PART_SUIT_GROUP Venus-->
  <migration name="PART_SUIT_GROUP_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GROUP_NO,P_NO_S,GROUP_TYPE,GROUP_NAME,MAX_NUM, 'Y' as FLAG,P_NO_S_OD,'' ISUSDNO_A from(
        select 'A' as GROUP_NO,SM_NO as P_NO_S,'0' as GROUP_TYPE,
        GROUP_NAME_A as GROUP_NAME,0 MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and isnull(GROUP_NAME_A,'') != ''
        union all
        select 'B' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_B as GROUP_NAME,MAX_NUM_B as MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_B>0
        union all
        select 'C' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_C as GROUP_NAME,MAX_NUM_C as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_C>0
        union all
        select 'D' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_D as GROUP_NAME,MAX_NUM_D as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_D>0
        union all
        select 'E' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_E as GROUP_NAME,MAX_NUM_E as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_E>0
        )sm
        order by  P_NO_S,GROUP_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_SUIT_GROUP." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="GROUP_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_TYPE"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MAX_NUM"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S_OD"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ISUSDNO_A"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--成套群组异动讯息 PART_SUIT_GROUP Venus-->
  <migration name="ADD_PART_SUIT_GROUP_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GROUP_NO,P_NO_S,GROUP_TYPE,GROUP_NAME,MAX_NUM, 'Y' as FLAG,P_NO_S_OD,'' ISUSDNO_A from(
        select 'A' as GROUP_NO,SM_NO as P_NO_S,'0' as GROUP_TYPE,
        GROUP_NAME_A as GROUP_NAME,0 MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and isnull(GROUP_NAME_A,'') != ''
        and (CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        union all
        select 'B' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_B as GROUP_NAME,MAX_NUM_B as MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_B>0
        and (CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        union all
        select 'C' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_C as GROUP_NAME,MAX_NUM_C as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_C>0
        and (CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        union all
        select 'D' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_D as GROUP_NAME,MAX_NUM_D as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_D>0
        and (CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        union all
        select 'E' as GROUP_NO,SM_NO as P_NO_S,'1' as GROUP_TYPE,
        GROUP_NAME_E as GROUP_NAME,MAX_NUM_E as  MAX_NUM,P_NO_S_OD,'' ISUSDNO_A
        from Smenu_h  where FLS_NO ='CO' and MAX_NUM_E>0
        and (CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        )sm
        order by  P_NO_S,GROUP_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_SUIT_GROUP." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="GROUP_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_TYPE"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MAX_NUM"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S_OD"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ISUSDNO_A"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--成套群组明细讯息 PART_SUIT_GROUP Venus-->
  <migration name="PART_SUIT_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select smd.P_NO,GROUP_TYPE as GROUP_NO,smd.SM_NO as SUIT_NO,smd.SM_NO as P_NO_S
        ,'' as UN_NO,SM_QTY as QTY,p.P_PRICE,0 as P_PRICE2
        , 0 as P_PRICE3,0 as P_PRICE4,0 as P_PRICE5,0 as P_PRICE6
        ,ADD_PRICE, 'Y' as FLAG ,CASE smd.GROUP_TYPE
        when 'A'  then 'Y'
        ELSE 'N' END PICK_DEF , 0  SOR_INDX
        from Smenu_d smd
        left join Smenu_h h on smd.SM_NO=h.SM_NO
        left join Part p on smd.P_NO=p.P_NO
        where h.FLS_NO ='CO'
        order by  smd.SM_NO,smd.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_SUIT_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUIT_NO"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="QTY"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADD_PRICE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PICK_DEF"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SOR_INDX"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--成套群组明细异动讯息 PART_SUIT_GROUP Venus-->
  <migration name="ADD_PART_SUIT_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select smd.P_NO,GROUP_TYPE as GROUP_NO,smd.SM_NO as SUIT_NO,smd.SM_NO as P_NO_S
        ,'' as UN_NO,SM_QTY as QTY,p.P_PRICE,0 as P_PRICE2
        , 0 as P_PRICE3,0 as P_PRICE4,0 as P_PRICE5,0 as P_PRICE6
        ,ADD_PRICE, 'Y' as FLAG ,CASE smd.GROUP_TYPE
        when 'A'  then 'Y'
        ELSE 'N' END PICK_DEF , 0  SOR_INDX
        from Smenu_d smd
        left join Smenu_h h on smd.SM_NO=h.SM_NO
        left join Part p on smd.P_NO=p.P_NO
        where h.FLS_NO ='CO'
        and (h.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or h.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        order by  smd.SM_NO,smd.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_SUIT_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUP_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUIT_NO"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="QTY"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADD_PRICE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PICK_DEF"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SOR_INDX"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--付款方式名称下传 PAY Venus-->
  <migration name="PAY_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select case [NAME] when 'PAY_1' then 'PAY_CASH' when 'PAY_2' then 'PAY_CARD' else [NAME] end PAY_ID
        ,[VALUE] as PAY_NAME, 'PAY' as PAY_KIND, '' as REMARK1, '' as REMARK2
        from Emisprop e
        where [NAME] like 'pay_%'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PAY." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="PAY_ID"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_KIND"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--促销表头 PROMOTE_H Venus-->
  <migration name="PROMOTE_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO, sg.S_NO) as S_NO
        , ph.PM_NO, ph.PM_ENABLE, ph.FLS_NO, ph.PM_CUST_LEVEL, ph.PM_PRIORITY, ph.PM_THEME
        , ph.PM_DATE_KIND, ph.PM_INTERVAL, ph.PM_COMBINE, ph.PM_CALC, ph.PM_ACCU, ph.PM_AREA,ph.PM_SL_TYPE
        , case when ph.PM_DATE_S = '' then '0' else ph.PM_DATE_S end PM_DATE_S
        , case when ph.PM_DATE_E = '' then '0' else ph.PM_DATE_E end PM_DATE_E
        , case when ph.PM_HOUR_S = '' then '0' else ph.PM_HOUR_S end PM_HOUR_S
        , case when ph.PM_HOUR_E = '' then '0' else ph.PM_HOUR_E end PM_HOUR_E
        , ph.PM_DAY_WEEK, ph.PM_DAY_MONTH, ph.PM_S_NO, ph.PM_S_KIND, ph.PM_SG_NO, ph.PM_FULL_AMT
        , ph.PM_FULL_AMT2, ph.PM_FULL_AMT3, ph.PM_TTL_QTY, ph.PM_TTL_QTY2, ph.PM_TTL_QTY3
        , ph.PM_PRICE, ph.PM_PRICE2, ph.PM_PRICE3, ph.CRE_USER, ph.CRE_DATE, ph.REMARK,ph.PM_BIRTH_KIND,ph.PM_BIRTH_B,ph.PM_BIRTH_A
        ,(select COUNT(RECNO) from PROMOTE_D pd where pd.PM_NO=ph.PM_NO) as PROMOTE_D_COUNT
        from Promote_h ph
        left join Store s on s.S_NO = ph.PM_S_NO
        left join Store_gd sg on sg.SG_NO = ph.PM_SG_NO
        where ph.FLS_NO = 'CO' and ph.PM_ENABLE = 'Y' and ph.PM_CALC != 0
        and ( ph.PM_DATE_KIND = '2' or (ph.PM_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) or ph.PM_COMBINE='99' )
        and isnull(s.S_NO, isnull(sg.S_NO, '')) != ''
        union all
        select s.S_NO,'ZZZZZZZZZZ' as MM_NO, '' as PM_ENABLE, '' as FLS_NO, '' as PM_CUST_LEVEL, 0 as PM_PRIORITY, '' as PM_THEME
        , 0 as PM_DATE_KIND, 0 as PM_INTERVAL, 0 as PM_COMBINE, 0 as PM_CALC, '' as PM_ACCU, 0 as PM_AREA,'' as PM_SL_TYPE
        , 0 as PM_DATE_S, 0 as PM_DATE_E, 0 as PM_HOUR_S, 0 as PM_HOUR_E
        , '' as PM_DAY_WEEK, '' as PM_DAY_MONTH, '' as PM_S_NO, '' as PM_S_KIND, '' as PM_SG_NO, 0 as PM_FULL_AMT
        , 0 as PM_FULL_AMT2, 0 as PM_FULL_AMT3, 0 as PM_TTL_QTY, 0 as PM_TTL_QTY2, 0 as PM_TTL_QTY3
        , 0 as PM_PRICE, 0 as PM_PRICE2, 0 as PM_PRICE3, '' as CRE_USER, '' as CRE_DATE, '' as REMARK,'' as PM_BIRTH_KIND,'' as PM_BIRTH_B,'' as PM_BIRTH_A
        , 0 as PROMOTE_D_COUNT
        from Store s
        where S_KIND != '3'
        union all
        select s.S_NO, ph.PM_NO, ph.PM_ENABLE, ph.FLS_NO, ph.PM_CUST_LEVEL, ph.PM_PRIORITY, ph.PM_THEME
        , ph.PM_DATE_KIND, ph.PM_INTERVAL, ph.PM_COMBINE, ph.PM_CALC, ph.PM_ACCU, ph.PM_AREA,ph.PM_SL_TYPE
        , case when ph.PM_DATE_S = '' then '0' else ph.PM_DATE_S end PM_DATE_S
        , case when ph.PM_DATE_E = '' then '0' else ph.PM_DATE_E end PM_DATE_E
        , case when ph.PM_HOUR_S = '' then '0' else ph.PM_HOUR_S end PM_HOUR_S
        , case when ph.PM_HOUR_E = '' then '0' else ph.PM_HOUR_E end PM_HOUR_E
        , ph.PM_DAY_WEEK, ph.PM_DAY_MONTH, ph.PM_S_NO, ph.PM_S_KIND, ph.PM_SG_NO, ph.PM_FULL_AMT
        , ph.PM_FULL_AMT2, ph.PM_FULL_AMT3, ph.PM_TTL_QTY, ph.PM_TTL_QTY2, ph.PM_TTL_QTY3
        , ph.PM_PRICE, ph.PM_PRICE2, ph.PM_PRICE3, ph.CRE_USER, ph.CRE_DATE, ph.REMARK,ph.PM_BIRTH_KIND,ph.PM_BIRTH_B,ph.PM_BIRTH_A
        , (select COUNT(RECNO) from PROMOTE_D pd where pd.PM_NO=ph.PM_NO) as PROMOTE_D_COUNT
        from PROMOTE_H ph
        inner join STORE s on charindex('/'+s.S_NO+'/','/'+ph.PM_GROUP_S_NO+'/')>0
        WHERE isnull(PM_GROUP_S_NO,'') != '' and ph.FLS_NO = 'CO' and ph.PM_ENABLE = 'Y'  and ph.PM_CALC != 0
          and ( ph.PM_DATE_KIND = '2' or (ph.PM_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) or ph.PM_COMBINE='99' )
        order by S_NO, PM_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PROMOTE_H."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PM_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_ENABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_CUST_LEVEL"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRIORITY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_THEME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_DATE_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_INTERVAL"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_COMBINE"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_CALC"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_ACCU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_AREA"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_DATE_E"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_HOUR_S"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_HOUR_E"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_DAY_WEEK"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_DAY_MONTH"/><target length="120" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_S_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_SG_NO"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_FULL_AMT"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_FULL_AMT2"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_FULL_AMT3"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_TTL_QTY"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_TTL_QTY2"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_TTL_QTY3"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE2"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE3"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_SL_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_BIRTH_KIND"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_BIRTH_B"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_BIRTH_A"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PROMOTE_D_COUNT"/><target type="Dec" format="#####0"  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--促销表身 PROMOTE_D Venus-->
  <migration name="PROMOTE_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO, sg.S_NO) as S_NO
        , pd.PM_NO, pd.RECNO, pd.IS_GIFT, pd.PM_D_KIND, pd.P_NO, pd.P_NO_S, pd.D_NO, pd.PM_QTY, pd.PM_RG
        , pd.PM_PRICE, pd.PM_PRICE2, pd.PM_PRICE3, pd.PM_PRICE4, pd.PM_PRICE5, pd.PM_PRICE6, pd.GIFT_PRICE, pd.IS_TO_K3
        from Promote_h ph
        inner join Promote_d pd on pd.PM_NO = ph.PM_NO
        left join Store s on s.S_NO = ph.PM_S_NO
        left join Store_gd sg on sg.SG_NO = ph.PM_SG_NO
        where ph.FLS_NO = 'CO' and ph.PM_ENABLE = 'Y' and ph.PM_CALC != 0
          and ( ph.PM_DATE_KIND = '2' or (ph.PM_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) or ph.PM_COMBINE='99' )
        and isnull(s.S_NO, isnull(sg.S_NO, '')) != ''
        union all
        select s.S_NO, 'ZZZZZZZZZZ' as MM_NO, 0 as RECNO, '' as IS_GIFT, 0 as PM_D_KIND, '' as P_NO, '' as P_NO_S, '' as D_NO, 0 as PM_QTY, 0 as PM_RG
        , 0 as PM_PRICE, 0 as PM_PRICE2, 0 as PM_PRICE3, 0 as PM_PRICE4, 0 as PM_PRICE5, 0 as PM_PRICE6, 0 as GIFT_PRICE, 'Y' as IS_TO_K3
        from Store s
        where S_KIND != '3'
        union all
        select s.S_NO, pd.PM_NO
        , pd.RECNO, pd.IS_GIFT, pd.PM_D_KIND, pd.P_NO, pd.P_NO_S, pd.D_NO, pd.PM_QTY, pd.PM_RG
        , pd.PM_PRICE, pd.PM_PRICE2, pd.PM_PRICE3, pd.PM_PRICE4, pd.PM_PRICE5, pd.PM_PRICE6, pd.GIFT_PRICE, pd.IS_TO_K3
        from PROMOTE_H ph
        inner join STORE s on charindex('/'+s.S_NO+'/','/'+ph.PM_GROUP_S_NO+'/')>0
        inner join Promote_d pd on pd.PM_NO = ph.PM_NO
        where  isnull(PM_GROUP_S_NO,'') != '' and ph.FLS_NO = 'CO' and ph.PM_ENABLE = 'Y' and ph.PM_CALC != 0
          and ( ph.PM_DATE_KIND = '2' or (ph.PM_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) or ph.PM_COMBINE='99' )
        order by S_NO, pd.PM_NO, pd.RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PROMOTE_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PM_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_GIFT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_D_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_QTY"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_RG"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE2"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE3"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE4"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE5"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_PRICE6"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GIFT_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_TO_K3"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--积分赠品设定 表头 PNTGFT_H_Venus-->
  <migration name="PNTGFT_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO,ph.GF_NO, ph.FLS_NO, ph.GF_NAME,ph.GF_DATE_S, ph.GF_DATE_E, ph.GF_RPT,
        ph.GF_TIMES,ph.GF_LOGSTR,ph.CRE_USER,ph.CRE_DATE,ph.REMARK FROM PNTGFT_H ph
        left join STORE s on charindex(','+s.S_NO+',',','+ph.S_NO+',')>0
        where ph.FLS_NO='AP' and ph.GF_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and isnull(ph.PLATFORM,'') != 'OL'
        order by s.S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PNTGFT_H."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="GF_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_DATE_E"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_RPT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_TIMES"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_LOGSTR"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--积分赠品设定 表身 PNTGFT_D_Venus-->
  <migration name="PNTGFT_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO,pd.GF_NO,pd.P_NO,pd.GF_POINT,isnull(pd.REMARK,'') REMARK
        from PNTGFT_D pd
        inner join PNTGFT_H ph on pd.GF_NO=ph.GF_NO
        left join STORE s on charindex(','+s.S_NO+',',','+ph.S_NO+',')>0
        where ph.FLS_NO='AP' and ph.GF_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and isnull(ph.PLATFORM,'') != 'OL'
        order by s.S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PNTGFT_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="GF_NO"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GF_POINT"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--现金管理-收入项 INCOME Venus-->
  <migration name="INCOME_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select CA_FUNC as FUNC_ID, CAS_NAME as FUNC_NAME, CA_TYPE as GROUPID, USED as USERD
        , case when NEED_CODE = 'Y' then 'N' else 'Y' end as FUNC_STR1
        , P_NO as FUNC_STR2, 0 as FUNC_NUM1, 1 as FUNC_NUM2, REMARK
        from cash_mgmt_set
        where CA_TYPE = 'INCOME' order by CA_FUNC
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="INCOME."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="FUNC_ID"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUPID"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR1"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR2"/><target length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM1"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM2"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--现金管理-支出项 OUTLAY Venus-->
  <migration name="OUTLAY_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select CA_FUNC as FUNC_ID, CAS_NAME as FUNC_NAME, CA_TYPE as GROUPID, USED as USERD
        , case when NEED_CODE = 'Y' then 'N' else 'Y' end as FUNC_STR1
        , P_NO as FUNC_STR2, 0 as FUNC_NUM1, 1 as FUNC_NUM2, REMARK
        from cash_mgmt_set
        where CA_TYPE = 'OUTLAY' order by CA_FUNC
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="OUTLAY."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="FUNC_ID"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUPID"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR1"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR2"/><target length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM1"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM2"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--IC礼券的密匙 ICGIFT_KEY VENUS -->
  <migration name="ICGIFT_KEY_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'ICGIFT_KEY' as VAR_NAME, [VALUE] as IC_KEY, 'SYS' as VAR_KIND, REMARK as REMARK1, '' as REMARK2
        from Emisprop e where [NAME] = 'ICGIFT_KEY'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="ICGIFT_KEY." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="VAR_NAME"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_KEY"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--IC签到退的密匙 ICDUTY_KEY VENUS -->
  <migration name="ICDUTY_KEY_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'ICDUTY_KEY' as VAR_NAME, [VALUE] as IC_KEY, 'SYS' as VAR_KIND, REMARK as REMARK1, '' as REMARK2
        from Emisprop e where [NAME] = 'ICDUTY_KEY'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="ICDUTY_KEY." posType="VIS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="VAR_NAME"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_KEY"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--2011/05/06 ZERO add 限时供应下传-->
  <migration name="SALE_TIME_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO,sg.S_NO) as S_NO,sth.ST_NO,sth.ST_ENABLE, sth.FLS_NO
        , sth.ST_CUST_LEVEL,sth.ST_THEME,sth.ST_DATE_KIND,sth.ST_INTERVAL,sth.ST_AREA
        , case when sth.ST_DATE_S = '' then '0' else sth.ST_DATE_S end ST_DATE_S
        , case when sth.ST_DATE_E = '' then '0' else sth.ST_DATE_E end ST_DATE_E
        , case when sth.ST_HOUR_S = '' then '0' else sth.ST_HOUR_S end ST_HOUR_S
        , case when sth.ST_HOUR_E = '' then '0' else sth.ST_HOUR_E end ST_HOUR_E
        , sth.ST_DAY_WEEK,sth.ST_DAY_MONTH,sth.ST_S_NO,sth.ST_SG_NO, sth.ST_S_KIND
        ,sth.CRE_USER,sth.CRE_DATE,sth.REMARK,sth.SL_TYPE
        from SALE_TIME_H sth
        left join STORE s on s.S_NO=sth.ST_S_NO
        left join STORE_GD sg on sg.SG_NO=sth.ST_SG_NO
        where sth.FLS_NO='CO' and sth.ST_ENABLE='Y'
        and (sth.ST_DATE_KIND ='2' or sth.ST_DATE_E >= convert(nvarchar(8), dbo.GetLocalDate(),112))
        and isnull(s.S_NO, isnull(sg.S_NO,'')) != ''
        union all
        select s.S_NO, 'ZZZZZZZZZZ' as ST_NO, '' as ST_ENABLE, '' as FLS_NO, '' as ST_CUST_LEVEL, '' as ST_THEME
        , 0 as ST_DATE_KIND, 0 as ST_INTERVAL, 0 as ST_AREA
        , 0 as ST_DATE_S, 0 as ST_DATE_E, 0 as ST_HOUR_S, 0 as ST_HOUR_E
        , '' as ST_DAY_WEEK, '' as ST_DAY_MONTH, '' as ST_S_NO, '' as ST_S_KIND, '' as ST_SG_NO
        , ''as CRE_USER, '' as CRE_DATE, '' as REMARK, '' as SL_TYPE
        from Store s
        where S_KIND != '3'
        order by S_NO, ST_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_TIME_H."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="ST_NO"/><target length="10" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_ENABLE"/><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="FLS_NO"/><target length="2" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_CUST_LEVEL"/><target length="12" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_THEME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_DATE_KIND"/><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_INTERVAL"/><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_AREA"/><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_DATE_S"/><target length="8" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_DATE_E"/><target length="8" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_HOUR_S"/><target length="6" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_HOUR_E"/><target length="6" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_DAY_WEEK"/><target length="14" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_DAY_MONTH"/><target length="120" autosize="true"/></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_S_NO"/><target length="12" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_S_KIND"/><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_SG_NO"/><target length="5" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="CRE_USER"/><target length="20" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="CRE_DATE"/><target length="8" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="SL_TYPE"/><target length="2" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="S_NO"/><target length="0" /></data>
  </migration>

  <migration name="SALE_TIME_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO, sg.S_NO) as S_NO
        ,std.ST_NO, std.RECNO, std.ST_D_KIND, std.P_NO, std.P_NO_S, std.D_NO
        from SALE_TIME_H sth
        inner join SALE_TIME_D std on std.ST_NO = sth.ST_NO
        left join Store s on s.S_NO = sth.ST_S_NO
        left join Store_gd sg on sg.SG_NO = sth.ST_SG_NO
        where sth.FLS_NO = 'CO' and sth.ST_ENABLE = 'Y'
        and ( sth.ST_DATE_KIND = '2' or (sth.ST_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) )
        and isnull(s.S_NO, isnull(sg.S_NO, '')) != ''
        union all
        select s.S_NO, 'ZZZZZZZZZZ' as ST_NO, 0 as RECNO, 0 as ST_D_KIND, '' as P_NO, '' as P_NO_S, '' as D_NO
        from Store s
        where S_KIND != '3'
        order by S_NO, std.ST_NO, std.RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_TIME_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="ST_NO" /><target length="10" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="RECNO" /><target length="6" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="ST_D_KIND" /><target length="1" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="P_NO" /><target length="30" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="P_NO_S" /><target length="30" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="D_NO" /><target length="10" /></data>
    <data><target value="@@@" length="3" /></data>
    <data><source name="S_NO" /><target length="0" /></data>
  </migration>

  <!--IC卡和条码卡黑名单(预开卡定额卡、注销、黑名单、作废) IC_GIFT_EXT VENUS -->
  <migration name="IC_GIFT_EXT_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GT_NO as IC_NO, '' as IC_NAME, '3' as IC_TYPE, gt.CARD_TYPE, 0 as IC_INTEGRATE, IC_AMT
        , AVA_DATE as EXPIRY_DATE, OPEN_VALUE, P_AMT as FACE_VALUE, IC_PCT, '0' as FLS_NO
        from gift_token gt
        left join GIFT_SET gs on gt.GS_NO=gs.GS_NO
        where ((gt.FLS_NO in ( '2B', '5', '6' ) and gt.IC_AMT != 0) or (gt.FLS_NO = '7') ) and gs.GS_TYPE in ('1')
        union all
        select '' as IC_NO, '' as IC_NAME, '' as IC_TYPE, '' as CARD_TYPE, 0 as IC_INTEGRATE, 0 as IC_AMT
        , '' as EXPIRY_DATE, 0 as OPEN_VALUE, 0 as FACE_VALUE, 0 as IC_PCT, '0' as FLS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="IC_GIFT_EXT." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="IC_NO"/><target  length="25" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_NAME"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_TYPE"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_TYPE"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_INTEGRATE"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_AMT"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EXPIRY_DATE"/><target  length="8" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OPEN_VALUE"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FACE_VALUE"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IC_PCT"/><target  length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--門市掛賬单位 STORE_SD Venus-->
  <migration name="STORE_SD_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'STORE_SD' as T_NO, sh.SD_NO as TD_NO, sh.SD_NAME as TD_NAME,0 TD_SEQ
        ,'Y' as USERD , sd.S_NO
        from STORE_SD_H sh
        inner join STORE_SD_D sd on sh.SD_NO=sd.SD_NO
        where sh.FLS_NO='CO'
        order by sd.S_NO, sh.SD_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE_SD."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

  <!--门店来电弹屏地址维护 ADDRESS Venus -->
  <migration name="S_ADDRESS_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select ADD_KEY,ADD_NO,C_NAME,ADDR,PHONE,S_NO
        from S_ADDRESS
        order by S_NO ,ADD_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="ADDRESS."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="ADD_KEY"/><target  length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADD_NO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDR"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PHONE"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
  </migration>

  <!--礼券种类 GIFT_SET Venus-->
  <migration name="GIFT_SET_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GS_NO,GS_NAME,GS_PECT_S,GS_PECT,GS_KIND,0 GS_VALUE,GS_FOREGIFT,GS_IS_BACK,isnull(RULE_VER,'V01') RULE_VER,GS_TYPE
        from GIFT_SET
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_SET." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="GS_NO"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_PECT_S"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_PECT"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_KIND"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_VALUE"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_FOREGIFT"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_IS_BACK"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RULE_VER"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_TYPE"/><target length="1"/></data>
  </migration>

  <!--小票广告资料下传(旧)-->
  <migration name="ADVERT_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'AD000'+convert(nvarchar(1),sd.RECNO) ID , convert(varchar(8),dbo.GetLocalDate(),112)  UPD_DATE
        ,sd.MS_NAME AD_CONT,'' ANN_STOP_D ,'AD' ANN_KIND,'Y' USED,'' MS_TIME_S,'' MS_TIME_E,B.S_NO
        from SMSG_D sd
        inner join (
        select max(A.MS_NO) as MS_NO,A.S_NO
        from (
        select case when isnull(s1.S_NO,'')!='' then s1.S_NO
        when isnull(s2.S_NO,'')!='' then s2.S_NO
        else s.S_NO end S_NO,mh.MS_NO
        from Smsg_h mh
        left join Store s on s.S_NO in (select S_NO from Store_gd where SG_NO = (case when isnull(mh.SG_NO,'')='' then 'ZZZZZZ' else mh.SG_NO end ))
        left join Store s1 on (case when isnull(mh.S_NO,'')='' then 'ZZZZZZZ' else mh.S_NO end)=s1.S_NO
        left join Store s2 on charindex('/'+s2.S_NO+'/','/'+mh.GROUP_S_NO+'/')>0
        where mh.FLS_NO='CO' and mh.MS_KIND='AT'
        union all
        select s.S_NO,mh.MS_NO
        from Smsg_h mh
        left join Store s on  1=1
        where mh.FLS_NO='CO' and mh.MS_KIND='AT' and isnull(mh.S_NO,'')='' and isnull(mh.SG_NO,'')='' and isnull(mh.GROUP_S_NO,'')=''
        ) as A
        where isnull(A.S_NO,'') !=''
        group by A.S_NO
        ) as B on B.MS_NO = sd.MS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="AD." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="ID"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="AD_CONT"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_STOP_D"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_KIND"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_S"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_E"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO" /><target length="0"/></data>
  </migration>

  <!--小票广告资料下传(新)-->
  <migration name="ADVERT_VENUS2">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'AD000'+convert(nvarchar(1),sd.RECNO) ID , convert(varchar(8),dbo.GetLocalDate(),112)  UPD_DATE
        ,sd.MS_NAME AD_CONT,'' ANN_STOP_D ,'AD' ANN_KIND,'Y' USED,'' MS_TIME_S,'' MS_TIME_E,B.S_NO
        from SMSG_D sd
        inner join (
        select max(A.MS_NO) as MS_NO,A.S_NO
        from (
        select case when isnull(s1.S_NO,'')!='' then s1.S_NO
        when isnull(s2.S_NO,'')!='' then s2.S_NO
        else s.S_NO end S_NO,mh.MS_NO
        from Smsg_h mh
        left join Store s on s.S_NO in (select S_NO from Store_gd where SG_NO = (case when isnull(mh.SG_NO,'')='' then 'ZZZZZZ' else mh.SG_NO end ))
        left join Store s1 on (case when isnull(mh.S_NO,'')='' then 'ZZZZZZZ' else mh.S_NO end)=s1.S_NO
        left join Store s2 on charindex('/'+s2.S_NO+'/','/'+mh.GROUP_S_NO+'/')>0
        where mh.FLS_NO='CO' and mh.MS_KIND='AT'
        union all
        select s.S_NO,mh.MS_NO
        from Smsg_h mh
        left join Store s on  1=1
        where mh.FLS_NO='CO' and mh.MS_KIND='AT' and isnull(mh.S_NO,'')='' and isnull(mh.SG_NO,'')='' and isnull(mh.GROUP_S_NO,'')=''
        ) as A
        where isnull(A.S_NO,'') !=''
        group by A.S_NO
        ) as B on B.MS_NO = sd.MS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="AD." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="ID"/><target  length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="AD_CONT"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_STOP_D"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_KIND"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_S"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_E"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO" /><target length="0"/></data>
  </migration>

  <!--卡片限制销售 GIFT_DATA_VENUS -->
  <migration name="GIFT_DATA_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select gt.S_NO, gt.GT_NO, 'GIFT_DATA' as G_TYPE from gift_token gt
        left join Store s on s.S_NO = gt.S_NO
        where gt.FLS_NO in ('1', '2', '3') and s.S_KIND not in ('3','4')
        order by gt.S_NO, gt.GT_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_DATA." posType="VI"
      timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="G_TYPE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GT_NO"/><target  length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO" /><target length="0" /></data>
  </migration>

  <!--券类销售付款档-->
  <migration name="ADD_GIFT_PAY_EXT_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GP_KEY,S_NO,ID_NO,GP_DATE,GP_TIME,GP_INKIND,GP_INVID,C_NO
        ,OP_NO,SA_NO,GP_INVTYPE,GP_INVNO_S,GP_INVNO_E,GP_KEY_O,FLS_NO
        ,EO_DATE,EO_TIME,GP_QTY,GP_AMT,FACE_AMT,PAY_AMT,PAY_CASH
        ,PAY_CARD,PAY_3,CARD_NO,REMARK
        ,CRE_USER,CRE_DATE,UPLOAD_DATE,UPLOAD_TIME,GIFT_TYPE
        from GIFT_PAY
        where CRE_DATE >= convert(varchar(8),dbo.GetLocalDate()-3,112)
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_PAY_EXT."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="GP_KEY"/><target  length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target  length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_TIME"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_INKIND"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_INVID"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="OP_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SA_NO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_INVTYPE"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_INVNO_S"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_INVNO_E"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_KEY_O"/><target  length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="EO_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EO_TIME"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_QTY"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GP_AMT"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FACE_AMT"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_AMT"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_CASH"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_CARD"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_3"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CARD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target  length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CRE_USER"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPLOAD_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPLOAD_TIME"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GIFT_TYPE"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <migration name="ADD_BILL_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select * from (
        --进货单资料
        select d.IN_NO BILL_NO, '' SL_KEY, d.S_NO, h.IN_DATE SL_DATE, 'IN' I_TYPE, h.CRE_TIME SL_TIME
        , sum(d.P_QTY) over(partition by h.S_NO, h.IN_NO) as SL_QTY_TOT
        , sum(d.P_QTY*d.P_PRICE) over(partition by h.S_NO, h.IN_NO) as SL_PRICE_TOT
        , h.REMARK, h.CRE_USER, h.CRE_DATE,'' UPLOAD_DATE,'' UPLOAD_TIME
        , d.RECNO, d.P_NO, d.P_QTY as SL_QTY, d.P_PRICE SL_PRICE, '' S_NO_OUT
        , 'S' LAST_FLAG, '' as DEF_V1, '' as POR_KIND, '' as STORE_V_NO, '' as PO_D_DATE, '' as PO_D_TIME
        , h.PM_NO, '' as SD_NO, h.SH_NO, '' as UPD_DATE, '' as UPD_TIME, h.ERP_NO, 0 as SL_AMT
        from Ins_d d
        inner join Ins_h h on d.IN_NO = h.IN_NO and d.S_NO = h.S_NO
        where h.FLS_NO = 'CF' and isnull(h.SL_KEY,'') = '' and h.S_NO != ''
        and h.IN_DATE >= convert(varchar(8),dbo.GetLocalDate()-7,112)
        union all
        --调拨单资料
        select td.TR_NO, '' SL_KEY, th.S_NO_IN, th.TR_DATE, 'TR' I_TYPE, th.CRE_TIME
        , sum(td.TR_IN_QTY) over(partition by th.S_NO_OUT, th.TR_NO) as SL_QTY_TOT
        , sum(td.TR_IN_QTY*isnull(td.P_PRICE,p.P_PRICE)) over(partition by th.S_NO_OUT, th.TR_NO) as SL_PRICE_TOT
        , th.REMARK, th.CRE_USER, th.CRE_DATE, '' UPLOAD_DATE, '' UPLOAD_TIME
        , td.RECNO, td.P_NO, td.TR_IN_QTY, isnull(td.P_PRICE,p.P_PRICE) as SL_PRICE, th.S_NO_OUT
        , 'S' LAST_FLAG, td.TR_OUT_REASON as DEF_V1, '' as POR_KIND, '' as STORE_V_NO, '' as PO_D_DATE, '' as PO_D_TIME
        , '' as PM_NO, '' as SD_NO, '' as SH_NO, '' as UPD_DATE, '' as UPD_TIME, '' as ERP_NO, 0 as SL_AMT
        from Tran_d td
        inner join Tran_h th on td.TR_NO = th.TR_NO and td.S_NO_OUT = th.S_NO_OUT
        left join Part p on p.P_NO = td.P_NO
        where th.FLS_NO = 'CF' and isnull(th.SL_KEY,'') = '' and th.S_NO_IN != ''
        and th.TR_DATE >= convert(varchar(8),dbo.GetLocalDate()-7,112)
        ) BILL
        order by S_NO, S_NO_OUT, BILL_NO, RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="BILL."
              timestamp="yyyyMMddHHmmsss" ext="ADD.BILL.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="BILL_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_KEY"/><target  length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="I_TYPE"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TIME"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_PRICE_TOT"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target  length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPLOAD_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPLOAD_TIME"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_PRICE"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_OUT"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LAST_FLAG"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V1"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="POR_KIND"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORE_V_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PO_D_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PO_D_TIME"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_NO"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SD_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SH_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_DATE"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_TIME"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ERP_NO"/><target  length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_AMT"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--客订表头-->
  <migration name="ADD_SALE_ORDER_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select S_NO,ID_NO,SL_DATE,SL_NO,SL_TIME,SL_INKIND,SL_INVID,C_NO,OP_NO,SA_NO,CL_NO,
        isnull(SL_QTY,0) SL_QTY,isnull(SL_AMT,0) SL_AMT,isnull(SL_TAXAMT,0) SL_TAXAMT,
        isnull(SL_NOTAXAMT,0) SL_NOTAXAMT,SL_DISC_AMT,SL_NDISC_AMT,SL_RECV_AMT,
        PAY_AMT,PAY_CASH,PAY_CARD,PAY_3,PAY_4,PAY_5,PAY_6,PAY_7,PAY_8,PAY_9,PAY_10,PAY_11,PAY_12,
        CARD_NO,rtrim(ltrim(replace(replace(isnull(REMARK, ''),char(13),' '), char(10), ' '))) REMARK,
        SL_TYPE,SHIFTWORK_TYPE,S_NO2,S_NO3,SEND_DATE,SEND_TIME,ORDER_NO,SHIP_DATE,
        CUST_NAME,PHONE, rtrim(ltrim(replace(replace(ADDRESS ,char(13),''), char(10), ''))) as ADDRESS,
        TIME_NO,PR_NO,EOM_DATE,MANUAL_DISC,MANUAL_DISC_CODE, rtrim(ltrim(replace(replace(isnull(ADDR_LINE, ''),char(13),''), char(10), ''))) as ADDR_LINE,
        MANUAL_DISC_AMT,STORE_SD,CHANGE,SHIP_TIME,
        soh.S_NO2 as S_NO_CRE, soh.SUBFLAG, soh.DEF_V1, soh.DEF_V2, case when soh.FLS_NO = 'CL' then '2' else '3' end as FLS_NO_F,
        soh.SYS_DISC,soh.SYS_DISC_AMT,soh.SYS_DISC_CODE, SL_INVAMT, PAY_15, PAY_16, PAY_17, PAY_18, PAY_19, PAY_20, PAY_21, PAY_22, PAY_23,
        PAY_24,PAY_25, PAY_26 , PAY_27, PAY_28, PAY_29, PAY_30, PAY_31, PAY_32, PAY_33, PAY_34, PAY_35, PAY_36, PAY_37, PAY_38,
        PAY_39,PAY_40, PAY_41, PAY_42, PAY_43, PAY_44, PAY_45 , PAY_46, PAY_47, PAY_48, PAY_49, PAY_50,
        OUT_TRADE_NO,AMOUNT,FUND_CHANNEL,TRADE_NO,BUYER_LOGON_ID,EXT_TAX_AMT,EXT_TAX_AMT_OLD,
        ALIPAY_DISC_AMT,ALIPAY_REAL_AMT,ALIPAY_RECE_AMT,ALIPAY_INVO_AMT,WXPAY_OUT_TRADE_NO,WXPAY_TOTAL_FEE,WXPAY_TRANSACTION_ID,WXPAY_COUPON_FEE,WXPAY_REFUND_ID,REMIND_DATE,REMIND_TIME
        from SALE_ORDER_H soh
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO2 and soh.S_NO2 != ''
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select S_NO,ID_NO,SL_DATE,SL_NO,SL_TIME,SL_INKIND,SL_INVID,C_NO,OP_NO,SA_NO,CL_NO,
        isnull(SL_QTY,0) SL_QTY,isnull(SL_AMT,0) SL_AMT,isnull(SL_TAXAMT,0) SL_TAXAMT,
        isnull(SL_NOTAXAMT,0) SL_NOTAXAMT,SL_DISC_AMT,SL_NDISC_AMT,SL_RECV_AMT,
        PAY_AMT,PAY_CASH,PAY_CARD,PAY_3,PAY_4,PAY_5,PAY_6,PAY_7,PAY_8,PAY_9,PAY_10,PAY_11,PAY_12,
        CARD_NO,rtrim(ltrim(replace(replace(isnull(REMARK, ''),char(13),' '), char(10), ' '))) REMARK,
        SL_TYPE,SHIFTWORK_TYPE,S_NO2,S_NO3,SEND_DATE,SEND_TIME,ORDER_NO,SHIP_DATE,
        CUST_NAME,PHONE,rtrim(ltrim(replace(replace(ADDRESS ,char(13),' '), char(10), ' '))) as ADDRESS,
        TIME_NO,PR_NO,EOM_DATE,MANUAL_DISC,MANUAL_DISC_CODE, rtrim(ltrim(replace(replace(isnull(ADDR_LINE, '') ,char(13),' '), char(10), ' '))) as ADDR_LINE,
        MANUAL_DISC_AMT,STORE_SD,CHANGE,SHIP_TIME,
        soh.S_NO3 as S_NO_CRE, soh.SUBFLAG, soh.DEF_V1, soh.DEF_V2, case when soh.FLS_NO = 'CL' then '2' else '3' end as FLS_NO_F,
        soh.SYS_DISC,soh.SYS_DISC_AMT,soh.SYS_DISC_CODE, SL_INVAMT, PAY_15, PAY_16, PAY_17, PAY_18, PAY_19, PAY_20, PAY_21, PAY_22, PAY_23,
        PAY_24,PAY_25, PAY_26 , PAY_27, PAY_28, PAY_29, PAY_30, PAY_31, PAY_32, PAY_33, PAY_34, PAY_35, PAY_36, PAY_37, PAY_38,
        PAY_39,PAY_40, PAY_41, PAY_42, PAY_43, PAY_44, PAY_45 , PAY_46, PAY_47, PAY_48, PAY_49, PAY_50,
        OUT_TRADE_NO,AMOUNT,FUND_CHANNEL,TRADE_NO,BUYER_LOGON_ID,EXT_TAX_AMT,EXT_TAX_AMT_OLD,
        ALIPAY_DISC_AMT,ALIPAY_REAL_AMT,ALIPAY_RECE_AMT,ALIPAY_INVO_AMT,WXPAY_OUT_TRADE_NO,WXPAY_TOTAL_FEE,WXPAY_TRANSACTION_ID,WXPAY_COUPON_FEE,WXPAY_REFUND_ID,REMIND_DATE,REMIND_TIME
        from SALE_ORDER_H soh
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO3 and soh.S_NO2 != soh.S_NO3 and soh.S_NO3 != ''
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select S_NO,ID_NO,SL_DATE,SL_NO,SL_TIME,SL_INKIND,SL_INVID,C_NO,OP_NO,SA_NO,CL_NO,
        isnull(SL_QTY,0) SL_QTY,isnull(SL_AMT,0) SL_AMT,isnull(SL_TAXAMT,0) SL_TAXAMT,
        isnull(SL_NOTAXAMT,0) SL_NOTAXAMT,SL_DISC_AMT,SL_NDISC_AMT,SL_RECV_AMT,
        PAY_AMT,PAY_CASH,PAY_CARD,PAY_3,PAY_4,PAY_5,PAY_6,PAY_7,PAY_8,PAY_9,PAY_10,PAY_11,PAY_12,
        CARD_NO,rtrim(ltrim(replace(replace(isnull(REMARK, ''),char(13),' '), char(10), ' '))) REMARK,
        SL_TYPE,SHIFTWORK_TYPE,S_NO2,S_NO3,SEND_DATE,SEND_TIME,ORDER_NO,SHIP_DATE,
        CUST_NAME,PHONE,rtrim(ltrim(replace(replace(ADDRESS ,char(13),' '), char(10), ' '))) as ADDRESS,
        TIME_NO,PR_NO,EOM_DATE,MANUAL_DISC,MANUAL_DISC_CODE, rtrim(ltrim(replace(replace(isnull(ADDR_LINE, '') ,char(13),' '), char(10), ' '))) as ADDR_LINE,
        MANUAL_DISC_AMT,STORE_SD,CHANGE,SHIP_TIME,
        soh.S_NO as S_NO_CRE, soh.SUBFLAG, soh.DEF_V1, soh.DEF_V2, case when soh.FLS_NO = 'CL' then '2' else '3' end as FLS_NO_F,
        soh.SYS_DISC,soh.SYS_DISC_AMT,soh.SYS_DISC_CODE, SL_INVAMT, PAY_15, PAY_16, PAY_17, PAY_18, PAY_19, PAY_20, PAY_21, PAY_22, PAY_23,
        PAY_24,PAY_25, PAY_26 , PAY_27, PAY_28, PAY_29, PAY_30, PAY_31, PAY_32, PAY_33, PAY_34, PAY_35, PAY_36, PAY_37, PAY_38,
        PAY_39,PAY_40, PAY_41, PAY_42, PAY_43, PAY_44, PAY_45 , PAY_46, PAY_47, PAY_48, PAY_49, PAY_50,
        OUT_TRADE_NO,AMOUNT,FUND_CHANNEL,TRADE_NO,BUYER_LOGON_ID,EXT_TAX_AMT,EXT_TAX_AMT_OLD,
        ALIPAY_DISC_AMT,ALIPAY_REAL_AMT,ALIPAY_RECE_AMT,ALIPAY_INVO_AMT,WXPAY_OUT_TRADE_NO,WXPAY_TOTAL_FEE,WXPAY_TRANSACTION_ID,WXPAY_COUPON_FEE,WXPAY_REFUND_ID,REMIND_DATE,REMIND_TIME
        from SALE_ORDER_H soh
        where isnull(soh.ID_NO,'')='' and soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP')
        and (soh.S_NO = soh.S_NO2 or soh.S_NO = soh.S_NO3)
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        order by S_NO_CRE
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_H."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INKIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVID"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SA_NO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CL_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NOTAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NDISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_RECV_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_CASH"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_CARD"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_3"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_4"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_5"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_6"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_7"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_8"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_9"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_10"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_11"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_12"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CARD_NO"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIFTWORK_TYPE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO2"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO3"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ORDER_NO"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CUST_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PHONE"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDRESS"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TIME_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PR_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EOM_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDR_LINE"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="STORE_SD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CHANGE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUBFLAG"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V1"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V2"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO_F"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>


    <data><source name="PAY_15"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_16"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_17"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_18"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_19"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_20"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_21"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_22"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_23"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_24"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_25"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_26"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_27"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_28"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_29"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_30"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_31"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_32"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_33"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_34"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_35"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_36"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_37"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_38"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_39"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_40"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_41"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_42"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_43"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_44"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_45"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_46"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_47"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_48"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_49"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_50"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>


    <data><source name="OUT_TRADE_NO"/><target length="64"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="AMOUNT"/><target length="300" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUND_CHANNEL"/><target length="300" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TRADE_NO"/><target length="64"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="BUYER_LOGON_ID"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EXT_TAX_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EXT_TAX_AMT_OLD"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_REAL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_RECE_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_INVO_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_OUT_TRADE_NO"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_TOTAL_FEE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_TRANSACTION_ID"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_COUPON_FEE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_REFUND_ID"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMIND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMIND_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--客订表身-->
  <migration name="ADD_SALE_ORDER_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select sod.S_NO,sod.ID_NO,sod.SL_DATE,sod.SL_NO,sod.RECNO,sod.P_NO,sod.P_TAX,sod.SL_QTY,sod.SL_PRICE,
        sod.SL_AMT,sod.SL_TAXAMT,sod.SL_NOTAXAMT,sod.SL_DISC_AMT,sod.D_NO,sod.D_DISC,sod.SEA_NO,
        sod.P_TYPE,sod.PK_RECNO,sod.P_NO_S,sod.DP_NO,sod.SEA_AMT,sod.MANUAL_DISC,
        sod.MANUAL_DISC_AMT,sod.P_QTY,sod.SORT_INX,sod.PK_SL_AMT,sod.PK_ADD_PRICE,sod.SYS_DISC,
        sod.SYS_DISC_AMT,sod.SYS_DISC_AMT_D,sod.IS_GIFT,sod.MANUAL_DISC_REAT,sod.MANUAL_DISC_CODE,sod.IS_GIVE_GIFT,
        'S' as LAST_FLAG,soh.S_NO2 as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_D sod
        inner join SALE_ORDER_H soh on soh.SL_KEY=sod.SL_KEY
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO2 and soh.S_NO2 != ''
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select sod.S_NO,sod.ID_NO,sod.SL_DATE,sod.SL_NO,sod.RECNO,sod.P_NO,sod.P_TAX,sod.SL_QTY,sod.SL_PRICE,
        sod.SL_AMT,sod.SL_TAXAMT,sod.SL_NOTAXAMT,sod.SL_DISC_AMT,sod.D_NO,sod.D_DISC,sod.SEA_NO,
        sod.P_TYPE,sod.PK_RECNO,sod.P_NO_S,sod.DP_NO,sod.SEA_AMT,sod.MANUAL_DISC,
        sod.MANUAL_DISC_AMT,sod.P_QTY,sod.SORT_INX,sod.PK_SL_AMT,sod.PK_ADD_PRICE,sod.SYS_DISC,
        sod.SYS_DISC_AMT,sod.SYS_DISC_AMT_D,sod.IS_GIFT,sod.MANUAL_DISC_REAT,sod.MANUAL_DISC_CODE,sod.IS_GIVE_GIFT,
        'S' as LAST_FLAG,soh.S_NO3 as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_D sod
        inner join SALE_ORDER_H soh on soh.SL_KEY=sod.SL_KEY
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO3 and soh.S_NO2 != soh.S_NO3 and soh.S_NO3 != ''
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select sod.S_NO,sod.ID_NO,sod.SL_DATE,sod.SL_NO,sod.RECNO,sod.P_NO,sod.P_TAX,sod.SL_QTY,sod.SL_PRICE,
        sod.SL_AMT,sod.SL_TAXAMT,sod.SL_NOTAXAMT,sod.SL_DISC_AMT,sod.D_NO,sod.D_DISC,sod.SEA_NO,
        sod.P_TYPE,sod.PK_RECNO,sod.P_NO_S,sod.DP_NO,sod.SEA_AMT,sod.MANUAL_DISC,
        sod.MANUAL_DISC_AMT,sod.P_QTY,sod.SORT_INX,sod.PK_SL_AMT,sod.PK_ADD_PRICE,sod.SYS_DISC,
        sod.SYS_DISC_AMT,sod.SYS_DISC_AMT_D,sod.IS_GIFT,sod.MANUAL_DISC_REAT,sod.MANUAL_DISC_CODE,sod.IS_GIVE_GIFT,
        'S' as LAST_FLAG,soh.S_NO as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_D sod
        inner join SALE_ORDER_H soh on soh.SL_KEY=sod.SL_KEY
        where isnull(soh.ID_NO,'')='' and soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP')
        and (soh.S_NO = soh.S_NO2 or soh.S_NO = soh.S_NO3)
        and soh.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        order by S_NO_CRE, SL_KEY_SEQ, RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_D."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_PRICE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NOTAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_DISC"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="MANUAL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_QTY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SORT_INX"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_ADD_PRICE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC"/><target length="100"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SYS_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_AMT_D"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_GIFT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_REAT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="LAST_FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_GIVE_GIFT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--客订折扣-->
  <migration name="ADD_SALE_ORDER_DIS_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select SUBSTRING(sodis.SL_KEY,1,LEN(sodis.SL_KEY) -1 ) SL_KEY,sodis.S_NO,sodis.ID_NO,sodis.SL_DATE,sodis.SL_NO,sodis.RECNO,sodis.DISC_SN,
        sodis.DISC_NO,sodis.DISC_AMT,sodis.DISC_QTY,sodis.DISC_CODE,sodis.REASON,soh.S_NO2 as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_DIS sodis
        inner join SALE_ORDER_H soh on soh.SL_KEY = sodis.SL_KEY
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO2 and soh.S_NO2 != ''
        and soh.SEND_DATE >= convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select SUBSTRING(sodis.SL_KEY,1,LEN(sodis.SL_KEY) -1 ) SL_KEY,sodis.S_NO,sodis.ID_NO,sodis.SL_DATE,sodis.SL_NO,sodis.RECNO,sodis.DISC_SN,
        sodis.DISC_NO,sodis.DISC_AMT,sodis.DISC_QTY,sodis.DISC_CODE,sodis.REASON,soh.S_NO3 as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_DIS sodis
        inner join SALE_ORDER_H soh on soh.SL_KEY = sodis.SL_KEY
        where soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP') and soh.S_NO != soh.S_NO3  and soh.S_NO2 != soh.S_NO3 and soh.S_NO3 != ''
        and soh.SEND_DATE >= convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        union all
        select SUBSTRING(sodis.SL_KEY,1,LEN(sodis.SL_KEY) -1 ) SL_KEY,sodis.S_NO,sodis.ID_NO,sodis.SL_DATE,sodis.SL_NO,sodis.RECNO,sodis.DISC_SN,
        sodis.DISC_NO,sodis.DISC_AMT,sodis.DISC_QTY,sodis.DISC_CODE,sodis.REASON,soh.S_NO as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_DIS sodis
        inner join SALE_ORDER_H soh on soh.SL_KEY = sodis.SL_KEY
        where isnull(soh.ID_NO,'')='' and soh.SL_DATE between '00000000' and 'ZZZZZZZZ' and soh.FLS_NO in ('PP', 'AP')
        and (soh.S_NO = soh.S_NO2  or soh.S_NO = soh.S_NO3)
        and soh.SEND_DATE >= convert(varchar(8),dbo.GetLocalDate()-2,112) and isnull(soh.WM_ORD_NO,'') = ''
        order by S_NO_CRE, SL_KEY_SEQ, RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_DIS."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="SL_KEY"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISC_SN"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISC_NO"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISC_QTY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="DISC_CODE"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REASON"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--已抛转12E的礼券客订单下传到客订門店-->
  <migration name="GIFT_ORDER_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select gd.ORDER_NO,gd.S_NO,gd.S_NO as S_NO_CRE,ST_NO,GT_NO_S,GT_NO_E,gd.SL_QTY,gd.SL_PRICE
        from ORDER_GIFT_DATA gd left join SALE_ORDER_H sh on gd.ORDER_NO=sh.ORDER_NO and sh.DEF_V1='999'
        where isnull(ST_NO,'')!=''and sh.FLS_NO not in('CO','CL') and isnull(GT_NO_S,'')!='' and isnull(GT_NO_E,'')!=''
        order by gd.S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_ORDER." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="ORDER_NO"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ST_NO"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GT_NO_S"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GT_NO_E"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_PRICE"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--結案的客訂資料傳送到其他門店(S530中结案时可指定SL_KEY下传,下面sql中的?将替换@REQ_PARAM参数值,排程执行时?会被替换成 1=1)-->
  <migration name="SALE_ORDER_FIN_2_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@REQ_PARAM,@REQ_PARAM,@REQ_PARAM,@REQ_PARAM">
      <SQL>
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, SEND_DATE, SEND_TIME, '6' as FLS_NO, S_NO as S_NO_CRE, '1' as S_SOURCE
        from sale_order_h  h
        where ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CO'
        and SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/
        and isnull(WM_ORD_NO,'') = ''
        union all
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, SEND_DATE, SEND_TIME, '6' as FLS_NO, S_NO2 as S_NO_CRE, '2' as S_SOURCE
        from sale_order_h  h
        where ( ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CO'
        and SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/ )
        and S_NO != S_NO2 and S_NO2 != '' and S_NO2 != '0000000'
        and isnull(WM_ORD_NO,'') = ''
        union all
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, SEND_DATE, SEND_TIME, '6' as FLS_NO, S_NO3 as S_NO_CRE, '3' as S_SOURCE
        from sale_order_h  h
        where ( ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CO'
        and SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/ )
        and S_NO != S_NO3 and S_NO3 != '' and S_NO3 != S_NO2
        and isnull(WM_ORD_NO,'') = ''
        union all
        /**宜芝多客户的客订单在ERP可以修改取货门店，这里下传资料至旧的取货门店，把前台的单结案掉**/
        select left(h.SL_KEY,len(h.SL_KEY)-1) as SL_KEY, h.SEND_DATE, h.SEND_TIME, '6' as FLS_NO, oldh.S_NO3 as S_NO_CRE, '3' as S_SOURCE
        from sale_order_h h inner join sale_order_h_old oldh on oldh.SL_KEY=h.SL_KEY
        where ( ? and h.SL_DATE between '00000000' and 'ZZZZZZZZ' and h.FLS_NO = 'CO'
        and h.SEND_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(h.SL_KEY,1) ='1'*/ )
        and h.S_NO != oldh.S_NO3 and oldh.S_NO3 != '' and h.S_NO3 != oldh.S_NO3 and h.S_NO2 != oldh.S_NO3
        and isnull(h.WM_ORD_NO,'') = ''
        order by S_NO_CRE, SL_KEY
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_FIN_2."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="SL_KEY"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_TIME"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--作廢的客訂資料傳送到其他門店(S530中注销时可指定SL_KEY下传,下面sql中的?将替换@REQ_PARAM参数值,排程执行时?会被替换成 1=1)-->
  <migration name="SALE_ORDER_FIN_3_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@REQ_PARAM,@REQ_PARAM,@REQ_PARAM,@REQ_PARAM">
      <SQL>
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, UPD_DATE as DEL_DATE, '2' as FLS_NO_DEL, '2' as FLS_NO_1, '2' as FLS_NO_2, S_NO as S_NO_CRE, '1' as S_SOURCE
        from sale_order_h h
        where ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CL'
        and UPD_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/
        and isnull(WM_ORD_NO,'') = ''
        union all
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, UPD_DATE as DEL_DATE, '2' as FLS_NO_DEL, '2' as FLS_NO_1, '2' as FLS_NO_2, S_NO2 as S_NO_CRE, '2' as S_SOURCE
        from sale_order_h  h
        where ( ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CL'
        and UPD_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/ )
        and S_NO != S_NO2 and S_NO2 != '' and S_NO2 != '0000000'
        and isnull(WM_ORD_NO,'') = ''
        union all
        select left(SL_KEY,len(SL_KEY)-1) as SL_KEY, UPD_DATE as DEL_DATE, '2' as FLS_NO_DEL, '2' as FLS_NO_1, '2' as FLS_NO_2, S_NO3 as S_NO_CRE, '3' as S_SOURCE
        from sale_order_h  h
        where ( ? and SL_DATE between '00000000' and 'ZZZZZZZZ' and FLS_NO = 'CL'
        and UPD_DATE >=  convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(SL_KEY,1) ='1'*/ )
        and S_NO != S_NO3 and S_NO3 != '' and S_NO3 != S_NO2
        and isnull(WM_ORD_NO,'') = ''
        union all
        /**宜芝多客户的客订单在ERP可以修改取货门店，这里下传资料至旧的取货门店，把前台的单注销掉**/
        select left(h.SL_KEY,len(h.SL_KEY)-1) as SL_KEY, h.UPD_DATE as DEL_DATE, '2' as FLS_NO_DEL, '2' as FLS_NO_1, '2' as FLS_NO_2, oldh.S_NO3 as S_NO_CRE, '3' as S_SOURCE
        from sale_order_h h with(nolock) inner join sale_order_h_old oldh on oldh.SL_KEY=h.SL_KEY
        where ( ? and h.SL_DATE between '00000000' and 'ZZZZZZZZ' and h.FLS_NO = 'CL'
        and h.UPD_DATE >= convert(varchar(8),dbo.GetLocalDate()-2,112)  /*and right(h.SL_KEY,1) ='1'*/ )
        and h.S_NO != oldh.S_NO3 and oldh.S_NO3 != '' and h.S_NO3 != oldh.S_NO3  and h.S_NO2 != oldh.S_NO3
        and isnull(h.WM_ORD_NO,'') = ''
        order by S_NO_CRE, SL_KEY
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_FIN_3."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="SL_KEY"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO_DEL"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO_1"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO_2"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--客订备注资料下传-->
  <migration name="SALE_ORDER_REMARK_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'SALE_ORDER_REMARK' as REMARK,TD_NO,TD_NAME,TD_SEQ,'Y' as IS_USED
        from TAB_D
        where T_NO='SALE_ORDER_REMARK'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_REMARK."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="REMARK"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--一般发票开票项目下传-->
  <migration name="ADD_INV_NAME_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'INV_NAME' as REMARK,TD_NO,TD_NAME,TD_SEQ,'Y' as IS_USED
        from TAB_D
        where T_NO='INV_NAME'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="INV_NAME."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="REMARK"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--卡券发票开票项目下传-->
  <migration name="ADD_INV_NAME2_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'INV_NAME2' as REMARK,TD_NO,TD_NAME,TD_SEQ,'Y' as IS_USED
        from TAB_D
        where T_NO='INV_NAME2'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="INV_NAME2."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="REMARK"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--发票作废原因下传-->
  <migration name="ADD_INV_VOID_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'INV_VOID' as REMARK,TD_NO,TD_NAME,TD_SEQ,'Y' as IS_USED
        from TAB_D
        where T_NO='INV_VOID'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="INV_VOID."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="REMARK"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--客订工厂出货时间-->
  <migration name="SHIP_TIME_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'SHIP_TIME' as REMARK,TD_NO,TD_NAME,TD_SEQ,'Y' as IS_USED
        from TAB_D
        where T_NO='SHIP_TIME'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SHIP_TIME."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="REMARK"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--库调/拨出/报损/退货原因-->
  <migration name="US_REASON_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from TAB_D
        where T_NO = 'US_REASON'
        union all
        select 'TR_REASON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from TAB_D
        where T_NO = 'TR_OUT_REASON'
        union all
        select 'SC_REASON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from TAB_D
        where T_NO = 'SC_REASON'
        union all
        select 'BA_REASON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from TAB_D
        where T_NO = 'BA_REASON'
        union all
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from TAB_D
        where T_NO = 'DIFF_REASON'
        union all
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as IS_USED
        from Tab_d
        where T_NO = 'BA_REASON_NEW'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="US_REASON."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target  length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>


  <!--3J 门店扩展付款别设定资料下传-->
  <migration name="STORE_CARD_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
          select s.S_NO,sc.* from STORE_CARD sc
          cross join store s
          where isnull(sc.USE_S_NO,'') != ''
          and  charindex('/'+s.S_NO+'/','/'+sc.USE_S_NO+'/')>0 and s.S_STATUS='1'
          union all
          select s.S_NO,sc.* from STORE_CARD sc
          cross join store s
          where isnull(sc.USE_S_NO,'')='' and s.S_STATUS='1'
          order by S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE_CARD."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="FUNC_ID"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NAME"/><target  length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUPID"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR1"/><target  length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_STR2"/><target  length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM1"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_NUM2"/><target  length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target  length="100"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--盘点单模板资料下传-->
  <migration name="COUNTM_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, ch.* from (
        select cd.PM_NO, ch.PM_NAME, cd.RECNO, cd.P_NO, cd.SEQNO, ch.IS_PART_S
        from CountM_D cd
        inner join CountM_H ch on ch.PM_NO = cd.PM_NO
        where ch.FLS_NO = 'CO' and isnull(ch.LOCK_S,'N') = 'N'
        ) ch
        cross join (select S_NO from Store where S_STATUS = '1') s
        union all
        select s.S_NO, cd.PM_NO, ch.PM_NAME, cd.RECNO, cd.P_NO, cd.SEQNO, ch.IS_PART_S
        from CountM_D cd
        inner join CountM_H ch on ch.PM_NO = cd.PM_NO
        inner join CountM_S cs on cs.PM_NO = ch.PM_NO
        inner join Store s on s.S_NO = cs.S_NO
        where ch.FLS_NO = 'CO' and ch.LOCK_S = 'Y' and s.S_STATUS = '1'
        order by S_NO, PM_NO, SEQNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="COUNTM."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PM_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_NAME"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQNO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_PART_S"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--POS机滚动讯息-->
  <migration name="SMSG_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select * from (
        select
        mh.MS_NO+convert(nvarchar(2),md.RECNO) as MS_NO,mh.MS_DATE_S,md.MS_NAME,mh.MS_DATE_E,'AN' as ANN_KIND,'Y' as USED,mh.MS_TIME_S,
        mh.MS_TIME_E,case when isnull(s1.S_NO,'')!='' then s1.S_NO else s.S_NO end S_NO
        from Smsg_d md
        inner join Smsg_h mh on md.MS_NO = mh.MS_NO
        left join Store s on s.S_NO in (select S_NO from Store_gd where SG_NO = (case when isnull(mh.SG_NO,'')='' then 'ZZZZZZ' else mh.SG_NO end ))
        left join Store s1 on (case when isnull(mh.S_NO,'')='' then 'ZZZZZZZ' else mh.S_NO end)=s1.S_NO
        where mh.MS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and convert(varchar(8),dbo.GetLocalDate(),112)>=mh.MS_DATE_S
        and mh.FLS_NO='CO'  and mh.MS_KIND='AN'
        )n
        where isnull(n.S_NO,'') != ''
        order by n.S_NO,n.MS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="AN." posType="VISC"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="MS_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_NAME"/><target  length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_DATE_E"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_KIND"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_S"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_E"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO" /><target length="0"/></data>
  </migration>

  <!--第二屏公告讯息-->
  <migration name="SMSG2_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select * from (
        select
        mh.MS_NO+convert(nvarchar(2),md.RECNO) as MS_NO,mh.MS_DATE_S,md.MS_NAME,mh.MS_DATE_E,'AS' as ANN_KIND,'Y' as USED,mh.MS_TIME_S,
        mh.MS_TIME_E,case when isnull(s1.S_NO,'')!='' then s1.S_NO else s.S_NO end S_NO
        from Smsg_d md
        inner join Smsg_h mh on md.MS_NO = mh.MS_NO
        left join Store s on s.S_NO in (select S_NO from Store_gd where SG_NO = (case when isnull(mh.SG_NO,'')='' then 'ZZZZZZ' else mh.SG_NO end ))
        left join Store s1 on (case when isnull(mh.S_NO,'')='' then 'ZZZZZZZ' else mh.S_NO end)=s1.S_NO
        where mh.MS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and convert(varchar(8),dbo.GetLocalDate(),112)>=mh.MS_DATE_S
        and mh.FLS_NO='CO'  and mh.MS_KIND='AS'
        )n
        where isnull(n.S_NO,'') != ''
        order by n.S_NO,n.MS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="AS."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="MS_NO"/><target  length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_NAME"/><target  length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_DATE_E"/><target  length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ANN_KIND"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_S"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MS_TIME_E"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO" /><target length="0"/></data>
  </migration>

  <!--IC 充值卡充值设定-表头资料-->
  <migration name="RECHARGE_SET_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO, sg.S_NO) as S_NO
        , ph.RS_NO, ph.RS_ENABLE,ph.FLS_NO, ph.RS_THEME
        , ph.RS_DATE_KIND, ph.RS_INTERVAL, ph.RS_AREA
        , case when ph.RS_DATE_S = '' then '0' else ph.RS_DATE_S end RS_DATE_S
        , case when ph.RS_DATE_E = '' then '0' else ph.RS_DATE_E end RS_DATE_E
        , case when ph.RS_HOUR_S = '' then '0' else ph.RS_HOUR_S end RS_HOUR_S
        , case when ph.RS_HOUR_E = '' then '0' else ph.RS_HOUR_E end RS_HOUR_E
        , ph.RS_DAY_WEEK, ph.RS_DAY_MONTH, ph.RS_S_NO, ph.RS_S_KIND, ph.RS_SG_NO
        , ph.CRE_USER, ph.CRE_DATE, ph.REMARK ,isnull(ph.RS_MAX_AMT,0) RS_MAX_AMT
        from RECHARGE_SET_H ph
        left join Store s on s.S_NO = ph.RS_S_NO
        left join Store_gd sg on sg.SG_NO = ph.RS_SG_NO
        where ph.FLS_NO = 'CO' and ph.RS_ENABLE = 'Y'
        and ( ph.RS_DATE_KIND = '2' or (RS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) )
        and isnull(s.S_NO, isnull(sg.S_NO, '')) != ''
        union all
          select s.S_NO
          , ph.RS_NO, ph.RS_ENABLE,ph.FLS_NO, ph.RS_THEME
          , ph.RS_DATE_KIND, ph.RS_INTERVAL, ph.RS_AREA
          , case when ph.RS_DATE_S = '' then '0' else ph.RS_DATE_S end RS_DATE_S
          , case when ph.RS_DATE_E = '' then '0' else ph.RS_DATE_E end RS_DATE_E
          , case when ph.RS_HOUR_S = '' then '0' else ph.RS_HOUR_S end RS_HOUR_S
          , case when ph.RS_HOUR_E = '' then '0' else ph.RS_HOUR_E end RS_HOUR_E
          , ph.RS_DAY_WEEK, ph.RS_DAY_MONTH, ph.RS_S_NO, ph.RS_S_KIND, ph.RS_SG_NO
          , ph.CRE_USER, ph.CRE_DATE, ph.REMARK ,isnull(ph.RS_MAX_AMT,0) RS_MAX_AMT
          from RECHARGE_SET_H ph
          left join STORE s on charindex('/'+s.S_NO+'/','/'+ph.RS_GROUP_S_NO+'/')>0
          WHERE isnull(RS_GROUP_S_NO,'') != '' and ph.FLS_NO = 'CO' and ph.RS_ENABLE = 'Y'
          and ( ph.RS_DATE_KIND = '2' or (RS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) )
        union all
        select s.S_NO,'ZZZZZZZZZZ' as RS_NO, '' as RS_ENABLE, '' as FLS_NO,'' as RS_THEME
        , 0 as RS_DATE_KIND, 0 as RS_INTERVAL, 0 as RS_AREA
        , 0 as RS_DATE_S, 0 as RS_DATE_E, 0 as RS_HOUR_S, 0 as RS_HOUR_E
        , '' as RS_DAY_WEEK, '' as RS_DAY_MONTH, '' as RS_S_NO, '' as RS_S_KIND, '' as RS_SG_NO
        , '' as CRE_USER, '' as CRE_DATE, '' as REMARK,0 RS_MAX_AMT
        from Store s
        where S_KIND != '3'
        order by S_NO, RS_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="RECHARGE_SET_H." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="RS_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_ENABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_THEME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_DATE_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_INTERVAL"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_AREA"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_DATE_E"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_HOUR_S"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_HOUR_E"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_DAY_WEEK"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_DAY_MONTH"/><target length="120" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_S_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_SG_NO"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_MAX_AMT"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--IC 充值卡充值设定-表身资料-->
  <migration name="RECHARGE_SET_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select pd.CE_NO,isnull(s.S_NO, sg.S_NO) as S_NO,pd.RS_NO
        ,pd.RECNO, pd.RS_AMT, pd.RS_PRICE,replace(replace(pd.REMARK,char(10),''),' ','') as REMARK,pd.RS_POINT
        from RECHARGE_SET_H ph
        inner join RECHARGE_SET_D pd on pd.RS_NO = ph.RS_NO
        left join Store s on s.S_NO = ph.RS_S_NO or charindex('/'+s.S_NO+'/','/'+ph.RS_GROUP_S_NO+'/')!=0
        left join Store_gd sg on sg.SG_NO = ph.RS_SG_NO
        where ph.FLS_NO = 'CO' and ph.RS_ENABLE = 'Y'
        and ( ph.RS_DATE_KIND = '2' or (RS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)) )
        and isnull(pd.P_RECNO,'') = ''
        and isnull(s.S_NO, isnull(sg.S_NO, '')) != ''
        union all
        select '' as CE_NO,s.S_NO, 'ZZZZZZZZZZ' as RS_NO
        ,0 as RECNO, 0 as RS_AMT, 0 as RS_PRICE ,'' REMARK, 0 as RS_POINT
        from Store s
        where S_KIND != '3'
        order by S_NO, pd.RS_NO, pd.RECNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="RECHARGE_SET_D." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="RS_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_AMT"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RS_POINT"/><target type="Dec" format="###0.00" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CE_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--门市外送比例 TAKE_OUT_PCT_Venus-->
  <migration name="TAKE_OUT_PCT_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select S_NO,'TAKE_OUT_PCT' as VAR_NAME, SALE_OUT_P as VAR_VALUE, 'SYS' as VAR_KIND, '' as REMARK1, '' as REMARK2
        from Store order by S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="TAKE_OUT_PCT."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="VAR_NAME"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_VALUE"/><target type="Dec" format="###0.00" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--客订单类型设定资料-->
  <migration name="SALE_ORDER_DEF">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from Systab_d where T_NO = 'SALE_ORDER_DEF1'
        and left(TD_NO,2) != '99'
        /*
        union all
        select 'SALE_ORDER_DEF2',TD_NO,P_NAME,TD_SEQ, 'Y' as USERD
        from CAKE_TAB
        */
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_DEF."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>
  <!--门市外带比例 PACK_OUT_PCT Venus-->
  <migration name="PACK_OUT_PCT_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select S_NO,'PACK_OUT_PCT' as VAR_NAME, SALE_PACK_P as VAR_VALUE, 'SYS' as VAR_KIND, '' as REMARK1, '' as REMARK2
        from Store order by S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PACK_OUT_PCT."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="VAR_NAME"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_VALUE"/><target type="Dec" format="###0.00" length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target  length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

   <!--集集需求,菜单自主更新功能-->
  <migration name="DATA_MANUAL_VENUS">
      <misource class="com.emis.app.migration.emisMiRDBSource">
        <SQL>
          select T_NO,TD_NO,TD_NAME,TD_SEQ,'Y' as USERD
          from Tab_d where T_NO='DATA_MANUAL'
            union all
          select  'DATA_MANUAL' as T_NO,'' as TD_NO,'' as TD_NAME,99 as TD_SEQ,'N' as USERD
          order by TD_SEQ
        </SQL>
      </misource>
      <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DATA_MANUAL."
         timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
      creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
      <data><source name="T_NO"/><target length="15"/></data>
      <data><target value="@@@" length="3"/></data>
      <data><source name="TD_NO"/><target length="20"/></data>
      <data><target value="@@@" length="3"/></data>
      <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
      <data><target value="@@@" length="3"/></data>
      <data><source name="TD_SEQ"/><target length="10"/></data>
      <data><target value="@@@" length="3"/></data>
      <data><source name="USERD"/><target length="1"/></data>
      <data><target value="@@@" length="3"/></data>
    </migration>

  <!--礼券号码区间有效性检测-->
  <migration name="GIFT_REG_CHK_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select GT_NO_S as GS_NO_S, MAX(GT_NO_E) as GS_NO_E, len(GT_NO_S) as GS_LEN,
        'PAY_4' as GS_PAY_TYPE, MAX(S_NO_USE) as GS_S_NO_USE,
        MAX(P_AMT) as GS_P_AMT, MAX(GS_NO) as GS_NO,
        MAX(GI_RULE) as GS_GI_RULE, MAX(GI_P_NO) as GS_GI_P_NO,
        MAX(RECNO_S) as GS_RECNO_S, MAX(RECNO_T) as GS_RECNO_T,
        MAX(RECNO_F) as GS_RECNO_F, MAX(P_NO) as GS_P_NO, dbo.erosGetP_NAME(MAX(P_NO)) as GS_P_NAME,
	      MAX(CARD_TYPE) as GS_CARD_TYPE,MAX(GUR_NO) as GS_GUR_NO
        from gift_log
        where FLS_NO = 'AP'
        group by GT_NO_S
        /**以下为虚拟会员卡的记录**/
        union all
        select ep2.VALUE+right('0000000000000',f.FD_MAXLEN-len(ep2.VALUE)) as GS_NO_S, ep2.VALUE+right('ZZZZZZZZZZZZZ',f.FD_MAXLEN-len(ep2.VALUE)) as GS_NO_E,
        case when f.FD_MAXLEN + 0 > 13 then 13 else f.FD_MAXLEN end as GS_LEN,
        'PAY_4' as GS_PAY_TYPE, '' as GS_S_NO_USE, 0 as  GS_P_AMT, ep2.VALUE as GS_NO, '1' as GS_GI_RULE, '' as GS_GI_P_NO, right('0000000000000',f.FD_MAXLEN-len(ep2.VALUE)) GS_RECNO_S,
        right('ZZZZZZZZZZZZZ',f.FD_MAXLEN-len(ep2.VALUE)) GS_RECNO_T, ep2.VALUE GS_RECNO_F, case when isnull(ep.VALUE,'')='' then '99999997' else ep.VALUE end GS_P_NO,
        case when p.P_NAME is null then case when isnull(ep3.VALUE,'')='' then N'虚拟会员卡商品' else ep3.VALUE end else p.P_NAME end GS_P_NAME,
        N'4' as GS_CARD_TYPE, '' as GS_GUR_NO
        from EMISPROP ep left join PART p on p.P_NO = ep.VALUE
        cross join FIELDFORMAT f
        cross join EMISPROP ep2
        cross join EMISPROP ep3
        where ep.NAME=N'EP_VCARD_P_NO' and ep2.NAME=N'EP_CUST_V_GS_NO' and ep3.NAME=N'ALIPAY_P_NAME' and FD_TYPE='CC_NO'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_REG_CHK." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="GS_NO_S"/><target length="25" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_NO_E"/><target length="25" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_LEN"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_PAY_TYPE"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_S_NO_USE"/><target length="2000" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_P_AMT"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_NO"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_GI_RULE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_GI_P_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_RECNO_S"/><target length="25" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_RECNO_T"/><target length="25" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_RECNO_F"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_P_NO"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
	  <data><source name="GS_CARD_TYPE"/><target length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GS_GUR_NO"/><target length="10" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--员工等级下传-->
  <migration name="OP_LEVEL_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        declare @sIS_OP_LEVEL nvarchar(2)
        select  @sIS_OP_LEVEL=[value] from emisProp where name='EP_IS_OP_LEVEL'
        SELECT  T_NO, TD_NO ,TD_NAME
        FROM SYSTAB_D WHERE T_NO = 'OP_LEVEL' and 'Y'=@sIS_OP_LEVEL
        Order by TD_SEQ
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="OP_LEVEL."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--前台权限下传-->
  <migration name="O_USERRIGHTS_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select USERGROUPS,USERID,GROUPID,FUNC_ID,RIGHTS
        from O_USERRIGHTS
        order by GROUPID,FUNC_ID,USERGROUPS
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="O_USERRIGHTS."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="USERGROUPS"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERID"/><target  length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GROUPID"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUNC_ID"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RIGHTS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--请购单请购类型下传-->
  <migration name="POR_KIND_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from Systab_d where T_NO = 'POR_KIND'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="POR_KIND."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--出货仓资料下传-->
  <migration name="STORE_V_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'STORE_V_NO' as T_NO,s.S_NO,s.S_NAME,isnull(sv.S_SEQ,0) as TD_SEQ,'Y' as USERD,sv.S_NO as S_NO_S
        from Store s
        inner join Store_v sv on sv.V_NO = s.S_NO
        where s.S_KIND in ('3','4') and s.S_STATUS = '1'
        order by sv.S_NO,sv.S_SEQ,s.S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE_V_NO."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_S"/>
    <data><source name="T_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_S"/><target length="0"/></data>
  </migration>

  <!--采购门店供应商资料下传-->
  <migration name="STORE_V2_NO_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select 'STORE_V2_NO' as T_NO,v.V_NO,v.V_NAME,0 as TD_SEQ,'Y' as USERD,sv.S_NO as S_NO_S
        from STORE_V2 sv
        inner join VENDOR v on v.V_NO = sv.V_NO
        inner join STORE s on s.S_NO=sv.S_NO
        where s.S_STATUS = '1'
        order by sv.S_NO,sv.V_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE_V2_NO."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_S"/>
    <data><source name="T_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="V_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="V_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_S"/><target length="0"/></data>
  </migration>

  <!--总部门店祥细资料下传-->
  <migration name="POS_STORE_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select S_NO, S_NAME, S_NAME_S, S_KIND, S_LEVEL, S_ADDR, S_TEL,
        S_FAX, S_EMAIL, CRE_DATE, CRE_USER, UPD_DATE, UPD_USER,
        REMARK, S_STATUS, MU_NO, S_TYPE, S_REGION_B, S_PROVINCE,
        S_CITY, S_REGION_S, SEND_LINE
        from store where S_STATUS = '1'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="POS_STORE."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="S_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NAME_S"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_LEVEL"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_ADDR"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_TEL"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_FAX"/><target length="15"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_EMAIL"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MU_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_TYPE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_REGION_B"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_PROVINCE"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_CITY"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_REGION_S"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_LINE"/><target length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--客订取货时间下传-->
  <migration name="ORD_CONFIG_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select isnull(s.S_NO,sg.S_NO) S_NO,O_C_ID,O_C_TIME_1,O_C_TIME_2,O_C_DAY from ORD_CONFIG oc
        left join STORE s on s.S_NO=oc.S_NO
        left join STORE_GD sg on sg.SG_NO=oc.SG_NO
        where oc.S_KIND!='0' and oc.FLS_NO='CF'
        union
        select s.S_NO,O_C_ID,O_C_TIME_1,O_C_TIME_2,O_C_DAY from ORD_CONFIG oc
        left join STORE s on 1=1
        where oc.S_KIND='0' and oc.FLS_NO='CF'
        order by S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="ORD_CONFIG."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="O_C_ID"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="O_C_TIME_1"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="O_C_TIME_2"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="O_C_DAY"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

  <!--请购单模板 PARTM（PARTM_H,PARTM_D） Venus-->
  <migration name="PARTM_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, ph.*
        from (
        select h.PM_NO,h.PM_NAME,h.V_NO,d.RECNO,d.P_NO,d.SEQNO,'' as UN_NO,replace(isnull(h.WEEKS,''),'0000000','') as WEEKS,isnull(h.BILL_TYPE,'@POR@') as BILL_TYPE
        from PartM_D d
        inner join PartM_H h on h.PM_NO=d.PM_NO where h.LOCK_S='N' and h.FLS_NO='CO'
        )ph
        cross join (select S_NO from vCCRStores) s
        union all
        select  s.S_NO,h.PM_NO,h.PM_NAME,h.V_NO,d.RECNO,d.P_NO,d.SEQNO,'' as UN_NO,replace(isnull(h.WEEKS,''),'0000000','') as WEEKS,isnull(h.BILL_TYPE,'@POR@') as BILL_TYPE
        from PartM_D d
        inner join PartM_H h on h.PM_NO=d.PM_NO
        inner join PartM_S pm on d.PM_NO=pm.PM_NO
        inner join vCCRStores s on s.S_NO = pm.S_NO
        where h.LOCK_S='Y' and h.FLS_NO='CO'
        order by S_NO,PM_NO,SEQNO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PARTM."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PM_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PM_NAME"/><target  length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="V_NO"/><target  length="30" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQNO"/><target  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="BILL_TYPE"/><target  length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WEEKS"/><target  length="7"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--會員紅利規則下傳-->
  <migration name="BONUS_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select NAME as VAR_NAME,VALUE as VAR_VALUE,'BONUS' VAR_KIND,REMARK as REMARK1,REMARK2
        from Emisprop e
        where MENU='32'
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="BONUS."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="VAR_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_VALUE"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--前后台系统参数下传-->
  <migration name="SYS_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select NAME as VAR_NAME,VALUE as VAR_VALUE,'SYS' VAR_KIND,REMARK as REMARK1,REMARK2
        from Emisprop e
        where MENU='SYS'
        union all
        /**新版充值前台用到的五个参数由后台固定下传**/
        select NAME as VAR_NAME,case NAME when 'SYNC_BALANCE_IN_CARD' then [VALUE] else 'true' end as VAR_VALUE,'SYS' VAR_KIND,REMARK as REMARK1,REMARK2
        from Emisprop e
        where NAME in ('IS_CUST_NO_INPUT','IS_CUST_QRY_CT','IS_CUST_QRYBY_PHONE','SYNC_BALANCE_IN_CARD','IS_BAR_CARD_ONLINE_CO')
          and exists(select NAME from Emisprop where NAME = 'EP_IC_AMT_LOCATION' and VALUE = '1')
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SYS." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="VAR_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_VALUE"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target length="80"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--大分類 SUBDEP_VENUS-->
  <migration name="SUBDEP_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select SUBDEP,SUB_NAME as  S_CNAME, row_number() over(order by SUBDEP) as SEQ_NO from SUBDEP order by SEQ_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SUBDEP." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="SUBDEP"/><target  length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_CNAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--门店部门资料下传-->
  <migration name="S_DEP_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select SD_NO, SD_NAME_S, SD_NAME, S_NO, SD_MANAGER
        from S_DEP
        where isnull(S_NO,'') != ''
        order by S_NO, SD_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="S_DEP."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="SD_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SD_NAME_S"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SD_MANAGER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--门店发票分配管理资料下传-->
  <migration name="TRAN_LOG_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select S_NO, SL_INVNO_S, SL_INVNO_E, SL_INVNO_CNT, SL_INVAMT, FLS_NO,
        CRE_USER, CRE_DATE, UPD_USER, UPD_DATE, REMARK
        from TRAN_LOG
        where FLS_NO = '3'
        order by S_NO, SL_INVNO_S, SL_INVNO_E
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="TRAN_LOG."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVNO_S"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVNO_E"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVNO_CNT"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVAMT"/><target type="Dec" format="###0.00" length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UPD_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>


  <!--预订变价表头档下传-->
  <migration name="PRECHG_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO,ph.PC_NO,ph.PC_CHG_D,ph.PC_KIND,ph.PC_SOURCE,ph.PC_UDEF,ph.FLD_NO
        ,ph.REMARK,ph.DEF_V1,ph.DEF_V2,ph.DEF_N3,ph.DEF_N4
        from PRECHG_H  ph
        inner join STORE s on ph.MU_NO = s.MU_NO
        where  ph.PC_KIND='2' and FLS_NO ='CF' and  s.MU_NO !='' and ph.PC_REMARK='S070'
        union all
        select s.S_NO,ph.PC_NO,ph.PC_CHG_D,ph.PC_KIND,ph.PC_SOURCE,ph.PC_UDEF,ph.FLD_NO,ph.REMARK
        ,ph.DEF_V1,ph.DEF_V2,ph.DEF_N3,ph.DEF_N4
        from PRECHG_H  ph
        cross join STORE s
        where  ph.PC_KIND='1' and FLS_NO = 'CF' and ph.PC_REMARK='S070'
        union all
        select  S_NO, '' PC_NO,'' PC_CHG_D,'' PC_KIND, '' PC_SOURCE, '' PC_UDEF,'' FLD_NO, '' REMARK
        ,'' DEF_V1,'' DEF_V2,0 DEF_N3,0 DEF_N4   from store
        order by  s.S_NO,ph.PC_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PRECHG_H."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PC_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PC_CHG_D"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PC_KIND"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PC_SOURCE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PC_UDEF"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLD_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V1"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V2"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_N3"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_N4"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--预订变价表身档下传-->
  <migration name="PRECHG_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select  s.S_NO, pd.PC_NO,pd.RECNO,pd.P_NO,pd.OP_PRICE,pd.P_PRICE,pd.P_PRICE2
        ,pd.P_PRICE3,pd.P_PRICE4,pd.P_PRICE5,pd.P_PRICE6
        from PRECHG_D pd
        inner join PRECHG_H ph on ph.PC_NO=pd.PC_NO
        inner join STORE s on ph.MU_NO=s.MU_NO
        where  ph.PC_KIND='2' and FLS_NO  = 'CF' and  s.MU_NO !='' and ph.PC_REMARK='S070'
        union all
        select s.S_NO, pd.PC_NO,pd.RECNO,pd.P_NO,pd.OP_PRICE,pd.P_PRICE,pd.P_PRICE2
        ,pd.P_PRICE3,pd.P_PRICE4,pd.P_PRICE5,pd.P_PRICE6
        from PRECHG_D pd
        inner join PRECHG_H ph on ph.PC_NO=pd.PC_NO
        cross join STORE s
        where  ph.PC_KIND='1' and FLS_NO = 'CF' and ph.PC_REMARK='S070'
        union all
        select  S_NO, '' PC_NO,0 RECNO,'' P_NO,0 OP_PRICE,0 P_PRICE,0 P_PRICE2
        ,0 P_PRICE3,0 P_PRICE4,0 P_PRICE5,0 P_PRICE6   from store
        order by  s.S_NO,pd.PC_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PRECHG_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="PC_NO"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--重新产生客订门店表头下传档 call in S530.jsp-->
  <migration name="UPD_SALE_ORDER_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" Params="REQ_PARAM">
      <SQL>
        select S_NO,ID_NO,SL_DATE,SL_NO,SL_TIME,SL_INKIND,SL_INVID,C_NO,OP_NO,SA_NO,CL_NO,
        isnull(SL_QTY,0) SL_QTY,isnull(SL_AMT,0) SL_AMT,isnull(SL_TAXAMT,0) SL_TAXAMT,
        isnull(SL_NOTAXAMT,0) SL_NOTAXAMT,SL_DISC_AMT,SL_NDISC_AMT,SL_RECV_AMT,
        PAY_AMT,PAY_CASH,PAY_CARD,PAY_3,PAY_4,PAY_5,PAY_6,PAY_7,PAY_8,PAY_9,PAY_10,PAY_11,PAY_12,
        CARD_NO,REMARK,SL_TYPE,SHIFTWORK_TYPE,S_NO2,S_NO3,SEND_DATE,SEND_TIME,ORDER_NO,SHIP_DATE,
        CUST_NAME,PHONE, rtrim(ltrim(replace(replace(ADDRESS ,char(13),''), char(10), ''))) as ADDRESS,
        TIME_NO,PR_NO,EOM_DATE,MANUAL_DISC,MANUAL_DISC_CODE, rtrim(ltrim(replace(replace(isnull(ADDR_LINE, ''),char(13),''), char(10), ''))) as ADDR_LINE,
        MANUAL_DISC_AMT,STORE_SD,CHANGE,SHIP_TIME,
        soh.S_NO as S_NO_CRE, soh.SUBFLAG, soh.DEF_V1, soh.DEF_V2, case when soh.FLS_NO = 'CL' then '2' else '3' end as FLS_NO_F,
        soh.SYS_DISC,soh.SYS_DISC_AMT,soh.SYS_DISC_CODE, SL_INVAMT, PAY_15, PAY_16, PAY_17, PAY_18, PAY_19, PAY_20, PAY_21, PAY_22, PAY_23,
        PAY_24,PAY_25, PAY_26 , PAY_27, PAY_28, PAY_29, PAY_30, PAY_31, PAY_32, PAY_33, PAY_34, PAY_35, PAY_36, PAY_37, PAY_38,
        PAY_39,PAY_40, PAY_41, PAY_42, PAY_43, PAY_44, PAY_45 , PAY_46, PAY_47, PAY_48, PAY_49, PAY_50,
        OUT_TRADE_NO,AMOUNT,FUND_CHANNEL,TRADE_NO,BUYER_LOGON_ID,EXT_TAX_AMT,EXT_TAX_AMT_OLD,
        ALIPAY_DISC_AMT,ALIPAY_REAL_AMT,ALIPAY_RECE_AMT,ALIPAY_INVO_AMT,WXPAY_OUT_TRADE_NO,WXPAY_TOTAL_FEE,WXPAY_TRANSACTION_ID,WXPAY_COUPON_FEE,WXPAY_REFUND_ID,REMIND_DATE,REMIND_TIME
        from SALE_ORDER_H soh
        where soh.FLS_NO in ('PP', 'AP') and ?
          and isnull(soh.WM_ORD_NO,'') = ''
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_H."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INKIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVID"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="C_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SA_NO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CL_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NOTAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NDISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_RECV_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_CASH"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_CARD"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_3"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_4"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_5"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_6"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_7"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_8"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_9"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_10"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_11"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_12"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CARD_NO"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIFTWORK_TYPE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO2"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO3"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ORDER_NO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="CUST_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PHONE"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDRESS"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TIME_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PR_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EOM_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDR_LINE"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="STORE_SD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CHANGE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUBFLAG"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V1"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V2"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO_F"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_INVAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>


    <data><source name="PAY_15"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_16"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_17"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_18"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_19"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_20"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_21"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_22"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_23"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_24"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_25"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_26"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_27"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_28"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_29"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_30"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_31"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_32"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_33"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_34"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_35"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_36"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_37"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_38"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="PAY_39"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_40"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_41"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_42"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_43"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_44"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_45"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_46"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_47"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_48"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_49"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PAY_50"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>


    <data><source name="OUT_TRADE_NO"/><target length="64"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="AMOUNT"/><target length="300" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FUND_CHANNEL"/><target length="300" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TRADE_NO"/><target length="64"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="BUYER_LOGON_ID"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EXT_TAX_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="EXT_TAX_AMT_OLD"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_REAL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_RECE_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ALIPAY_INVO_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_OUT_TRADE_NO"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_TOTAL_FEE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_TRANSACTION_ID"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_COUPON_FEE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="WXPAY_REFUND_ID"/><target length="32"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMIND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMIND_TIME"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>


  <!--2K1重新产生客订门店表身下传档-->
  <migration name="UPD_SALE_ORDER_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource" Params="REQ_PARAM">
      <SQL>
        select sod.S_NO,sod.ID_NO,sod.SL_DATE,sod.SL_NO,sod.RECNO,sod.P_NO,sod.P_TAX,sod.SL_QTY,sod.SL_PRICE,
        sod.SL_AMT,sod.SL_TAXAMT,sod.SL_NOTAXAMT,sod.SL_DISC_AMT,sod.D_NO,sod.D_DISC,sod.SEA_NO,
        sod.P_TYPE,sod.PK_RECNO,sod.P_NO_S,sod.DP_NO,sod.SEA_AMT,sod.MANUAL_DISC,
        sod.MANUAL_DISC_AMT,sod.P_QTY,sod.SORT_INX,sod.PK_SL_AMT,sod.PK_ADD_PRICE,sod.SYS_DISC,
        sod.SYS_DISC_AMT,sod.SYS_DISC_AMT_D,sod.IS_GIFT,sod.MANUAL_DISC_REAT,sod.MANUAL_DISC_CODE,sod.IS_GIVE_GIFT,
        'S' as LAST_FLAG,soh.S_NO as S_NO_CRE, soh.SL_KEY as SL_KEY_SEQ
        from SALE_ORDER_D sod
        inner join SALE_ORDER_H soh on soh.SL_KEY=sod.SL_KEY
        where soh.FLS_NO in ('PP', 'AP') and ?
          and isnull(soh.WM_ORD_NO,'') = ''
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_D."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ID_NO"/><target length="9"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_QTY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_PRICE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_NOTAXAMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_DISC"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="200" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="MANUAL_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_QTY"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SORT_INX"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_SL_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PK_ADD_PRICE"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="SYS_DISC_AMT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SYS_DISC_AMT_D"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_GIFT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_REAT"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="MANUAL_DISC_CODE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="LAST_FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_GIVE_GIFT"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--旧系统换卡-异常卡券别档资料下传-->
  <migration name="CHANGE_CARD_REPAIR_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select NEW_CARD, CARD_TYPE, REMARK
        from CHANGE_CARD_REPAIR
        where REMARK = '0'
        order by NEW_CARD
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CHANGE_CARD_REPAIR." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="NEW_CARD"/><target length="50"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CARD_TYPE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!-- 产品名称档 PART_H VENUS_FC -->
  <migration name="PART_H_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO,/* s.SEA_NO*/
        case when s.SEA_NO = '' then ph.SEA_NO else s.SEA_NO end as SEA_NO
        , ph.P_TYPE,s.RECNO as SEQ_NO, 'Y' as FLAG , ph.PRINT_LABLE ,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
        select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
        , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE,'0' as P_TYPE ,dd.DISP_FLAG
        from Ddepart dd
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y'
        Union All
        select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
        ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
        ,h.SM_DP_NO D_NO,'' SEA_NO, 'N' as PRINT_LABLE, '1' as P_TYPE ,'12' as DISP_FLAG
        from Smenu_h h
        where FLS_NO!='ED'
        )ph
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, isnull(pdd.SEA_NO,'') as SEA_NO
        from store s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        where s.S_STATUS = '1' and ph.FLS_NO = 'Y'
        ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
        order by S_NO, ph.D_NO, SEQ_NO, P_NO_S
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_H." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>

    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRINT_LABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISP_FLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

  <!-- 产品名称档(异动) ADD_PART_H VENUS_FC -->
  <migration name="ADD_PART_H_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, ph.P_NO_S, ph.P_NAME_S, ph.USED, ph.D_NO, /* s.SEA_NO*/
        case when s.SEA_NO = '' then ph.SEA_NO else s.SEA_NO end as SEA_NO
        , ph.PRINT_LABLE, ph.P_TYPE, s.RECNO as SEQ_NO, 'Y' as FLAG ,isnull(ph.DISP_FLAG,'12') as DISP_FLAG
        from (
        select dd.DD_NO as P_NO_S, dd.DD_CNAME as P_NAME_S, dd.D_DOWN as USED
        , dd.D_NO, isnull(dd.SEA_NO,'') as SEA_NO, dd.PRINT_LABLE, '0' as P_TYPE, dd.CRE_DATE, dd.UPD_DATE ,dd.DISP_FLAG
        from Ddepart dd
        inner join Depart d on dd.D_NO = d.D_NO
        where d.D_DOWN = 'Y'
        Union All
        select h.SM_NO as P_NO_S,h.SM_NAME as P_NAME_S
        ,case FLS_NO when 'CO' then 'Y' else 'N' end  USED
        ,h.SM_DP_NO D_NO,'' SEA_NO,'N' as PRINT_LABLE, '1' as P_TYPE, h.CRE_DATE, h.UPD_DATE,'12' as DISP_FLAG
        from Smenu_h h
        where FLS_NO!='ED'
        )ph
        inner join (
        select S_NO, pd.D_NO, pdd.DD_NO, pdd.RECNO, pdd.UPD_DATE, isnull(pdd.SEA_NO,'') as SEA_NO
        from store s
        inner join PART_MENU_H ph on ph.MU_NO = s.MU_NO
        inner join PART_MENU_D pd on pd.MU_NO = ph.MU_NO
        inner join PART_MENU_DD pdd on pdd.MU_NO = pd.MU_NO and pdd.D_NO = pd.D_NO
        where s.S_STATUS = '1' and ph.FLS_NO = 'Y'
        ) s on s.D_NO = ph.D_NO and s.DD_NO = ph.P_NO_S
        where (ph.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or ph.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or s.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        order by S_NO, ph.D_NO, SEQ_NO, P_NO_S
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_H." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="40"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target  length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEA_NO"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRINT_LABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISP_FLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/></data>
  </migration>

  <!-- 产品明细 PART_D VENUS_FC -->
  <migration name="PART_D_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, pp.P_NO, pp.DD_NO as P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE else p.P_PRICE end P_PRICE
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY,p.P_PHOTO,p.IS_POR,p.P_PS_QTY
        from Store s
        inner join Part_Menu_h ph on ph.MU_NO = s.MU_NO
        inner join part_Menu_d pd on pd.MU_NO = s.MU_NO
        inner join part_Menu_dd pdd on pdd.MU_NO = s.MU_NO and pdd.D_NO = pd.D_NO
        inner join part_Menu_p pp on pp.MU_NO = s.MU_NO and pp.D_NO = pd.D_NO and pp.DD_NO = pdd.DD_NO
        inner join (
        select p.P_NO, p.P_NAME, case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, '' as LBL_NAME, p.IS_WEIGH as IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, '' as STORAGE_LIFE
        , '' as P_NO_OD, '' as REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY,p.P_PHOTO,p.IS_POR,p.P_PS_QTY
        from Part p
        union all
        select smh.SM_NO, smh.SM_NAME, case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' AS P_PHOTO
        ,'Y' as IS_POR,'' as P_PS_QTY
        from Smenu_h smh where FLS_NO != 'ED'
        ) p on p.P_NO = pp.P_NO
        where s.S_STATUS = '1' and ph.FLS_NO = 'Y'
        order by s.S_NO, pp.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_POR"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PS_QTY"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!-- 产品明细 (异动) PART_D VENUS_FC -->
  <migration name="ADD_PART_D_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO, pp.P_NO, pp.DD_NO as P_NO_S, p.P_NAME, p.USED, p.UN_NO
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE else p.P_PRICE end P_PRICE
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE2 else p.P_PRICE2 end P_PRICE2
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE3 else p.P_PRICE3 end P_PRICE3
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE4 else p.P_PRICE4 end P_PRICE4
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE5 else p.P_PRICE5 end P_PRICE5
        , case when pp.SP_PRICE_USERD = 'Y' then pp.SP_PRICE6 else p.P_PRICE6 end P_PRICE6
        , p.P_PU, p.P_TAX, p.LBL_NAME, 0 as SEQ_NO, 'Y' as FLAG, p.IS_WEIGH, p.P_DC, p.CUN_NO, p.P_EAN
        , p.STORAGE_LIFE STORAGE_LIFE_1, p.P_NO_OD, p.REM_CODE, dbo.emisGetProperty('EPOS_TAX') as P_TAX_RATE
        , 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO
        from Store s
        inner join Part_Menu_h ph on ph.MU_NO = s.MU_NO
        inner join part_Menu_d pd on pd.MU_NO = s.MU_NO
        inner join part_Menu_dd pdd on pdd.MU_NO = s.MU_NO and pdd.D_NO = pd.D_NO
        inner join part_Menu_p pp on pp.MU_NO = s.MU_NO and pp.D_NO = pd.D_NO and pp.DD_NO = pdd.DD_NO
        inner join (
        select p.P_NO, p.P_NAME, case p.P_STATUS when '0' then 'Y' when '1' then 'Y' else 'N' end as USED
        , p.P_DEFC as UN_NO, p.P_PRICE, p.P_PRICE2, p.P_PRICE3, p.P_PRICE4, p.P_PRICE5, p.P_PRICE6
        , p.P_PU, p.P_TAX, '' as LBL_NAME, p.IS_WEIGH as IS_WEIGH, p.P_DC, p.UN_NO as CUN_NO, p.P_EAN, '' as STORAGE_LIFE
        , '' as P_NO_OD, '' as REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, p.P_NAME_S, p.P_PY, p.P_PHOTO
        from Part p
        union all
        select smh.SM_NO, smh.SM_NAME, case FLS_NO when 'CO' then 'Y' else 'N' end USED
        , '' as UN_NO, SM_PRICE as P_PRICE, SM_PRICE2 as P_PRICE2
        , SM_PRICE3 as P_PRICE3, SM_PRICE4 as P_PRICE4, SM_PRICE5 as P_PRICE5, SM_PRICE6 as P_PRICE6
        , P_PU, SM_TAX as P_TAX, '' as LBL_NAME, '' as IS_WEIGH, '' as P_DC, '' as CUN_NO, '' as P_EAN, '' as STORAGE_LIFE
        , '' P_NO_OD, '' REM_CODE, 0 AS PRICE_MAX, 0 AS PRICE_MIN, '' AS P_NAME_S, SM_PY as P_PY, '' as P_PHOTO
        from Smenu_h smh where FLS_NO != 'ED'
        ) p on p.P_NO = pp.P_NO
        where s.S_STATUS = '1' and ph.FLS_NO = 'Y'
        and ( pdd.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or pp.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112) )
        order by s.S_NO, pp.P_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PART_D." posType="VS"
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="P_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target  length="13"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USED"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEQ_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="UN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE2"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE3"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE4"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE5"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PRICE6"/><target  length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PU"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLAG"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="LBL_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_WEIGH"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_DC"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUN_NO"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_EAN"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="STORAGE_LIFE_1"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_OD"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REM_CODE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_TAX_RATE"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MAX"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PRICE_MIN"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NAME_S"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PY"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_PHOTO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>

  </migration>

  <!-- ========== 门店相关 BEGIN ========== -->
  <!-- 员工资料 CASHIER VENUS_FC -->
  <migration name="CASHIER_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select op.S_NO as S_NO_T, op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, op.OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '2' and OP_DWN='Y' and op.OP_STATUS = '1' and isnull(op.S_NO,'') != ''
        union all
        select op.S_NO as S_NO_T, op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        inner join Store s on s.S_NO = op.S_NO
        where op.S_SOURCE = '2' and OP_DWN='N' and op.OP_STATUS = '1'
        and ( (op.IS_CASHIER = 'Y' and s.S_KIND = '4') or  (op.IS_ACC = '1' and s.S_KIND = '3') )
        union all
        select s.S_NO as S_NO_T, op.*
        from (
        select op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '2' and OP_DWN='N'  and op.OP_STATUS = '1'
        and op.IS_CASHIER = 'Y' and isnull(op.S_NO,'') = ''
        ) op
        cross join (select s.S_NO from Store s where s.S_SOURCE = '2' and s.S_STATUS = '1' and s.S_KIND = '4' ) s
        union all
        select s.S_NO as S_NO_T, op.*
        from (
        select op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '2' and OP_DWN='N' and op.OP_STATUS = '1'
        and op.IS_ACC = '1' and isnull(op.S_NO,'') = ''
        ) op
        cross join (select s.S_NO from Store s where s.S_SOURCE = '2' and s.S_STATUS = '1' and s.S_KIND = '3' ) s
        order by 1, 2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CASHIER." posType="VI"
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_T"/>
    <data><source name="OP_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PASSWORD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_LEVEL"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CSHER_CARD"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_DWN"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_ACC"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_HR"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_T"/><target length="0"/></data>
  </migration>

  <!-- 员工资料(异动) CASHIER VENUS_FC -->
  <migration name="UPD_CASHIER_VENUS_FC">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select op.S_NO as S_NO_T, op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '2' and op.OP_STATUS = '1' and isnull(op.S_NO,'') != ''
        and (op.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or op.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        union all
        select op.S_NO as S_NO_T, op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        inner join Store s on s.S_NO = op.S_NO
        where op.S_SOURCE = '1' and op.OP_STATUS = '1'
        and (op.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or op.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        and ( (op.IS_CASHIER = 'Y' and s.S_KIND = '1') or  (op.IS_ACC = '1' and s.S_KIND = '3') )
        union all
        select s.S_NO as S_NO_T, op.*
        from (
        select op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '1' and op.OP_STATUS = '1'
        and op.IS_CASHIER = 'Y' and isnull(op.S_NO,'') = ''
        and (op.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or op.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        ) op
        cross join (select s.S_NO from Store s where s.S_SOURCE = '1' and s.S_STATUS = '1' and s.S_KIND = '1' ) s
        union all
        select s.S_NO as S_NO_T, op.*
        from (
        select op.OP_NO, op.OP_NAME, op.OP_PASSWORD, op.OP_LEVEL, op.OP_STATUS
        , op.CSHER_CARD, 'Y' as OP_DWN, op.S_NO, op.IS_ACC, 'N' as IS_HR
        from Cashier op
        where op.S_SOURCE = '1' and op.OP_STATUS = '1'
        and op.IS_ACC = '1' and isnull(op.S_NO,'') = ''
        and (op.CRE_DATE = convert(varchar(8),dbo.GetLocalDate(),112) or op.UPD_DATE = convert(varchar(8),dbo.GetLocalDate(),112))
        ) op
        cross join (select s.S_NO from Store s where s.S_SOURCE = '1' and s.S_STATUS = '1' and s.S_KIND = '3' ) s
        order by 1, 2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CASHIER."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_T"/>
    <data><source name="ST_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ST_NAME"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_PASSWORD"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_LEVEL"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ST_STATUS"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CSHER_CARD"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="OP_DWN"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_ACC"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="IS_HR"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_T"/><target length="0"/></data>
  </migration>

    <!-- IC卡种类 GIFT_SET VENUS_FC -->
    <migration name="GIFT_SET_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select GS_NO,GS_NAME,GS_PECT_S,GS_PECT,GS_KIND,0 GS_VALUE
                ,GS_FOREGIFT,GS_IS_BACK,isnull(RULE_VER,'V01') RULE_VER
                from gift_set
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_SET." posType="VI"
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data>
            <source name="GS_NO"/>
            <target length="3"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_NAME"/>
            <target length="30"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_PECT_S"/>
            <target length="10"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_PECT"/>
            <target length="10"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_KIND"/>
            <target length="2"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_VALUE"/>
            <target length="15"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_FOREGIFT"/>
            <target length="15"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_IS_BACK"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="RULE_VER"/>
            <target length="3"/>
        </data>
    </migration>

    <!-- IC卡入库记录 GIFT_LOG VENUS_FC -->
    <migration name="GIFT_LOG_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select LOG_NO,GS_NO,RECNO_F+RECNO_S as CARD_NO_S,RECNO_F+RECNO_T as CARD_NO_E,AVA_DATE
                from gift_log
                where FLS_NO = 'AP'
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_LOG."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data>
            <source name="LOG_NO"/>
            <target length="11"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="GS_NO"/>
            <target length="3"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="CARD_NO_S"/>
            <target length="25"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="CARD_NO_E"/>
            <target length="25"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="AVA_DATE"/>
            <target length="8"/>
        </data>
    </migration>

    <!-- 退餐原因档 CARD_BACK_REASON VENUS_FC -->
    <migration name="CARD_BACK_REASON_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select 'CARD_BACK_REASON' as T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
                from Tab_d where T_NO = 'CARD_BACK_REASON'
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="CARD_BACK_REASON."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data>
            <source name="T_NO"/>
            <target length="20"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="TD_NO"/>
            <target length="20"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="TD_NAME"/>
            <target length="50"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="TD_SEQ"/>
            <target length="4"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="USERD"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
    </migration>

    <!-- 门店资料下传 STORE VENUS_FC -->
    <migration name="S_NO_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select 'STORE' as T_NO,S_NO,S_NAME,0 as TD_SEQ,'Y' as USERD from STORE
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="STORE."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data>
            <source name="T_NO"/>
            <target length="10"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="S_NO"/>
            <target length="10"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="S_NAME"/>
            <target length="50"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="TD_SEQ"/>
            <target length="10"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="USERD"/>
            <target length="1"/>
        </data>
    </migration>

    <!-- 美食街 前台公告下传 AN VENUS_FC -->
    <migration name="AN_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select * from (
                select
                mh.MS_NO+convert(nvarchar(2),md.RECNO) as MS_NO,mh.MS_DATE_S,md.MS_NAME,mh.MS_DATE_E,'AN' as ANN_KIND,'Y' as USED,mh.MS_TIME_S,
                mh.MS_TIME_E,case when isnull(s1.S_NO,'')!='' then s1.S_NO else s.S_NO end S_NO
                from Smsg_d md
                inner join Smsg_h mh on md.MS_NO = mh.MS_NO
                left join Store s on s.S_NO in (select S_NO from Store_gd where SG_NO = (case when isnull(mh.SG_NO,'')='' then 'ZZZZZZ' else mh.SG_NO
                end ))
                left join Store s1 on (case when isnull(mh.S_NO,'')='' then 'ZZZZZZZ' else mh.S_NO end)=s1.S_NO
                where mh.MS_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and convert(varchar(8),dbo.GetLocalDate(),112)>=mh.MS_DATE_S
                and mh.FLS_NO='CO' and mh.MS_KIND='AN'
                )n
                where isnull(n.S_NO,'') != ''
                order by n.S_NO,n.MS_NO
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="AN."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
        <data>
            <source name="MS_NO"/>
            <target length="12"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="MS_DATE_S"/>
            <target length="8"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="MS_NAME"/>
            <target length="100"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="MS_DATE_E"/>
            <target length="8"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="ANN_KIND"/>
            <target length="2"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="USED"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="MS_TIME_S"/>
            <target length="4"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="MS_TIME_E"/>
            <target length="4"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="S_NO"/>
            <target length="0"/>
        </data>
    </migration>

    <!-- 产品部门 DEPART VENUS_FC -->
    <migration name="DEPART_VENUS_FC">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select s.S_NO, pd.D_NO, d.[GROUP] as SUBDEP, d.D_CNAME, '' as D_ENAME
                , d.USED, pd.RECNO, d.SEA_NO, dbo.venusGetPDefCList() as UN_NO, '' as SALE_OPT, '1' as DP_TYPE, '' as D_NO_OD
                from Store s
                inner join Part_Menu_h ph on ph.MU_NO = s.MU_NO
                inner join part_Menu_d pd on pd.MU_NO = ph.MU_NO
                inner join Depart d on d.D_NO = pd.D_NO
                where s.S_STATUS = '1' and ph.FLS_NO = 'Y'
                order by s.S_NO, pd.RECNO
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DEPART." posType="VS"
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
        <data>
            <source name="D_NO"/>
            <target length="4"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="SUBDEP"/>
            <target length="2"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="D_CNAME"/>
            <target length="40"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="D_ENAME"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="USED"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="RECNO"/>
            <target length="4"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="SEA_NO"/>
            <target padding=" " length="100" autosize="true"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="UN_NO"/>
            <target padding=" " length="100" autosize="true"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="SALE_OPT"/>
            <target length="3"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="DP_TYPE"/>
            <target length="1"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="D_NO_OD"/>
            <target length="2"/>
        </data>
        <data>
            <target value="@@@" length="3"/>
        </data>
        <data>
            <source name="S_NO"/>
        </data>
    </migration>
    <!-- 付款方式名称下传 PAY VENUS_FC -->
    <migration name="PAY_VENUS_FC">
      <misource class="com.emis.app.migration.emisMiRDBSource">
        <SQL>
          select case [NAME] when 'PAY_1' then 'PAY_CASH' when 'PAY_2' then 'PAY_CARD' else [NAME] end PAY_ID
          ,[VALUE] as PAY_NAME, 'PAY' as PAY_KIND, '' as REMARK1, '' as REMARK2
          from Emisprop e
          where [NAME] like 'pay_%'
        </SQL>
      </misource>
      <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="PAY."
                timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
                creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
      <data>
        <source name="PAY_ID"/>
        <target length="20"/>
      </data>
      <data>
        <target value="@@@" length="3"/>
      </data>
      <data>
        <source name="PAY_NAME"/>
        <target length="20"/>
      </data>
      <data>
        <target value="@@@" length="3"/>
      </data>
      <data>
        <source name="PAY_KIND"/>
        <target length="3"/>
      </data>
      <data>
        <target value="@@@" length="3"/>
      </data>
      <data>
        <source name="REMARK1"/>
        <target length="1"/>
      </data>
      <data>
        <target value="@@@" length="3"/>
      </data>
      <data>
        <source name="REMARK2"/>
        <target length="1"/>
      </data>
      <data>
        <target value="@@@" length="3"/>
      </data>
    </migration>
  <!--第三方支付渠道设定（嗖嗖、银联商务MISPOS交易、轻易付、银联POS交易）下传-->
  <migration name="SYS_TAB_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select std.T_NO, std.TD_NO, std.TD_NAME, std.TD_SEQ, 'Y' as USERD from SysTab_d std
        inner join SysTab_h sth on std.T_NO = sth.T_NO
        left join EMISPROP ep on ep.NAME='ETRADE_PAY'
        left join EMISPROP ep2 on ep2.NAME='UMSMIS_PAY'
        left join EMISPROP ep3 on ep3.NAME='VERYPAY_PAY'
		left join EMISPROP ep4 on ep4.NAME='GMCMIS_PAY'
        where sth.T_DOWN = 'Y' and (
          (std.T_NO='ETRADE_CHANNEL' and ep.VALUE!='') or
          (std.T_NO='UMSMIS_CHANNEL' and ep2.VALUE!='') or
          (std.T_NO='VERYPAY_CHANNEL' and ep3.VALUE!='') or
		  (std.T_NO='GMCMIS_CHANNEL' and ep4.VALUE!='') or
          std.T_NO not in ('ETRADE_CHANNEL','UMSMIS_CHANNEL','VERYPAY_CHANNEL','GMCMIS_CHANNEL')
        )
        order by std.T_NO, std.TD_SEQ
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SYS_TAB_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>
    <!--售货员资料完整档 SALER_VENUS-->
    <migration name="SALER_VENUS">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select SA_NO, SA_NAME, SA_SEX, S_NO
                from Saler
                order by SA_NO,SA_NAME
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALER."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data><source name="SA_NO"/><target length="10"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SA_NAME"/><target length="20"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SA_SEX"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="S_NO"/><target length="12"/></data>
        <data><target value="@@@" length="3"/></data>
    </migration>

    <!--售货员资料异动档 UPD_SALER_VENUS-->
    <migration name="UPD_SALER_VENUS">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select SA_NO, SA_NAME, SA_SEX, S_NO
                from Saler
                where (3>=datediff(day,CRE_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)) or 3>=datediff(day,UPD_DATE,CONVERT(nvarchar(8),dbo.GetLocalDate(),112)))
                order by SA_NO,SA_NAME
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALER."
                  timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
        <data><source name="SA_NO"/><target length="10"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SA_NAME"/><target length="20"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="SA_SEX"/><target length="1"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="S_NO"/><target length="12"/></data>
        <data><target value="@@@" length="3"/></data>
    </migration>

    <!--差勤班别下传排程 DUTY_TAB_VENUS-->
    <migration name="DUTY_TAB_VENUS">
        <misource class="com.emis.app.migration.emisMiRDBSource">
            <SQL>
                select s.S_NO,DT_SHIFT,DT_DESC,DT_TIME_S,DT_TIME_E,DT_MHOUR,DT_TIME_S1,DT_TIME_E1,dbo.emisGetTabName('SHIFT',DT_SHIFT) as DT_SHIFT_NAME
                from DUTY_TAB dt cross join (
                select S_NO from STORE s
                where S_STATUS = '1' and not exists(select S_NO from DUTY_TAB where S_NO = s.S_NO)
                ) s
                where dt.S_NO = ''
                union all
                select S_NO,DT_SHIFT,DT_DESC,DT_TIME_S,DT_TIME_E,DT_MHOUR,DT_TIME_S1,DT_TIME_E1,dbo.emisGetTabName('SHIFT',DT_SHIFT) as DT_SHIFT_NAME
                from DUTY_TAB
                where S_NO != ''
                order by S_NO,DT_SHIFT
            </SQL>
        </misource>
        <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="DUTY_TAB."
                  timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
                  creationrule="com.emis.app.migration.ePosGroupCreationRule"
                  creationkey="S_NO"/>
        <data><source name="S_NO"/><target length="12"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_SHIFT"/><target length="2"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_DESC"/><target length="20"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_TIME_S"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_TIME_E"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_MHOUR"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_TIME_S1"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_TIME_E1"/><target length="4"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="DT_SHIFT_NAME"/><target length="50" autosize="true"/></data>
        <data><target value="@@@" length="3"/></data>
        <data><source name="S_NO"/><target length="12"/></data>
    </migration>

  <!-- 外卖平台对接 - 拒单原因,拒绝取消原因 -->
  <migration name="WEB_ORD_REASON">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select T_NO, TD_NO, TD_NAME, TD_SEQ, 'Y' as USERD
        from Tab_d
        where T_NO in('WEB_ORD_REASON_1', 'WEB_ORD_REASON_2') and TD_SEQ > 0
        order by 1, 2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_DEF."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.emisAllStoreCreationRule" creationkey=""/>
    <data><source name="T_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NO"/><target  length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_NAME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="TD_SEQ"/><target length="4"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="USERD"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
  </migration>

  <!--宜芝多客制-ERP修改客订表头信息下传-->
  <migration name="SALE_ORDER_INFO">
    <misource class="com.emis.app.migration.emisMiRDBSource" params="@REQ_PARAM">
      <SQL>
        select h.*,s.S_NO as S_NO_CRE
        from(
        select left(h.SL_KEY,len(h.SL_KEY)-1) as SL_KEY, h.SEND_DATE, h.SEND_TIME,h.S_NO3,h.CUST_NAME,h.PHONE,rtrim(ltrim(replace(replace(h.ADDRESS ,char(13),''), char(10), ''))) as ADDRESS
          ,h.SHIP_DATE,h.SHIP_TIME,h.DEF_V1,h.ORDER_NO,rtrim(ltrim(replace(replace(h.REMARK ,char(13),''), char(10), '')))+case when isnull(h.POS2ERP_NO,'')!='' then '['+h.POS2ERP_NO+']' else '' end as REMARK
          ,h.S_NO2,h.SL_TYPE,isnull(h.SUBFLAG,'') as SUBFLAG,isnull(h.DEF_V2,'') as DEF_V2
          ,h.S_NO
        from sale_order_h h inner join sale_order_h_old oldh on oldh.SL_KEY=h.SL_KEY
        where ? and oldh.ERP2POS_DATE >= convert(varchar(8),dbo.GetLocalDate()-2,112) and h.SL_DATE between '00000000' and 'ZZZZZZZZ' and h.FLS_NO in('PP','AP')
          and isnull(h.WM_ORD_NO,'') = ''
        ) h cross join STORE s
        where s.S_NO=h.S_NO or s.S_NO=h.S_NO2 or s.S_NO=h.S_NO3
        order by S_NO_CRE, SL_KEY
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SALE_ORDER_INFO."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO_CRE"/>
    <data><source name="SL_KEY"/><target length="40" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SEND_TIME"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO3"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CUST_NAME"/><target length="20" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="PHONE"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ADDRESS"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SHIP_TIME"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V1"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="ORDER_NO"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="500" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO2"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SL_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="SUBFLAG"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DEF_V2"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO_CRE"/><target length="0"/></data>
  </migration>

  <!--后台生成前台参数emisprop.DAT下传-->
  <migration name="SYS_VENUS_DOWNLOAD">
    <misource class="com.emis.app.migration.emisMiRDBSource"  params="@REQ_PARAM">
      <SQL>
        select S_NO,VAR_NAME,VAR_VALUE,VAR_KIND,REMARK1,REMARK2 from SYS_VENUS sv
        cross join store s
        where ?
        order by S_NO
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="SYS."
              timestamp="yyyyMMddHHmmsss" ext="UPD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="VAR_NAME"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_VALUE"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="VAR_KIND"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK1"/><target length="80"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK2"/><target length="100" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>

    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--现金券使用规则设定表头下传 GIFT_USE_RULE_H_VENUS-->
  <migration name="GIFT_USE_RULE_H_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO
        ,h.GUR_NO  ,N'Y' GUR_ENABLE  ,'CO' as FLS_NO  ,h.GUR_CUST_LEVEL  ,h.GUR_PRIORITY  ,h.GUR_THEME
        ,1 as GUR_DATE_KIND  ,0 GUR_INTERVAL  ,h.GUR_COMBINE  ,1 as GUR_AREA,'' as GUR_SL_TYPE
        ,h.GUR_DATE_S,h.GUR_DATE_E,h.GUR_HOUR_S,h.GUR_HOUR_E,h.GUR_DAY_WEEK,h.GUR_DAY_MONTH
        ,s.S_NO GUR_S_NO  ,'' GUR_S_KIND  ,'' GUR_SG_NO  ,h.GUR_FULL_AMT
        ,h.DISC_USE  ,h.CRE_USER  ,h.CRE_DATE  ,h.REMARK, h.GUR_MAX_QTY
        ,case h.GUR_COMBINE when 20 then 0 else ( select COUNT(RECNO) from GIFT_USE_RULE_D d where d.GUR_NO=h.GUR_NO ) end GIFT_USE_RULE_D_CNT
        from GIFT_USE_RULE_H h with(nolock)
        cross join vCCRStores s with(nolock)
        where h.FLS_NO = 'AP' and h.GUR_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and isnull(h.GUR_S_NO,'') = ''
        union all
        select s.S_NO
        ,h.GUR_NO  ,N'Y' GUR_ENABLE  ,'CO' as FLS_NO  ,h.GUR_CUST_LEVEL  ,h.GUR_PRIORITY  ,h.GUR_THEME
        ,1 as GUR_DATE_KIND  ,0 GUR_INTERVAL  ,h.GUR_COMBINE  ,1 as GUR_AREA,'' as GUR_SL_TYPE
        ,h.GUR_DATE_S,h.GUR_DATE_E,h.GUR_HOUR_S,h.GUR_HOUR_E,h.GUR_DAY_WEEK  ,h.GUR_DAY_MONTH
        ,s.S_NO GUR_S_NO  ,'' GUR_S_KIND  ,'' GUR_SG_NO  ,h.GUR_FULL_AMT
        ,h.DISC_USE  ,h.CRE_USER  ,h.CRE_DATE  ,h.REMARK, h.GUR_MAX_QTY
        ,case h.GUR_COMBINE when 20 then 0 else ( select COUNT(RECNO) from GIFT_USE_RULE_D d where d.GUR_NO=h.GUR_NO ) end GIFT_USE_RULE_D_CNT
        from GIFT_USE_RULE_H h with(nolock)
        inner join vCCRStores s with(nolock) on charindex('/'+s.S_NO+'/','/'+h.GUR_S_NO+'/')>0
        where h.FLS_NO = 'AP' and h.GUR_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112) and isnull(h.GUR_S_NO,'') != ''
        union all
        select s.S_NO
        ,'ZZZZZZZZZZ' as GUR_NO  ,N'' as GUR_ENABLE  ,'' as FLS_NO  ,'' as GUR_CUST_LEVEL  ,0 as GUR_PRIORITY  ,'' as GUR_THEME
        ,0 as GUR_DATE_KIND  ,0 as GUR_INTERVAL  ,0 as GUR_COMBINE  ,0 as GUR_AREA,'' as GUR_SL_TYPE
        ,'0' as GUR_DATE_S,'0' as GUR_DATE_E,'0' as GUR_HOUR_S,'0' as GUR_HOUR_E,'' as GUR_DAY_WEEK  ,'' as GUR_DAY_MONTH
        ,'' as GUR_S_NO  ,'' as GUR_S_KIND  ,'' as GUR_SG_NO  ,0 as GUR_FULL_AMT
        ,'' as DISC_USE  ,'' as CRE_USER  ,'' as CRE_DATE  ,'' as REMARK, 0 as GUR_MAX_QTY, 0 as GIFT_USE_RULE_D_CNT
        from vCCRStores s with(nolock)
        order by 1,2
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_USE_RULE_H."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="GUR_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_ENABLE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="FLS_NO"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_CUST_LEVEL"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_THEME"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_DATE_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_INTERVAL"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_COMBINE"/><target length="3"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_AREA"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_DATE_S"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_DATE_E"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_HOUR_S"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_HOUR_E"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_DAY_WEEK"/><target length="14"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_DAY_MONTH"/><target length="120" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_S_NO"/><target length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_S_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_SG_NO"/><target length="5"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_FULL_AMT"/><target type="Dec" format="###0.00" length="12"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_USER"/><target length="20"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="CRE_DATE"/><target length="8"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="REMARK"/><target length="50" autosize="true"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_SL_TYPE"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GIFT_USE_RULE_D_CNT"/><target type="Dec" format="#####0"  length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_MAX_QTY"/><target type="Dec" format="#####0" length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="DISC_USE"/><target length="2"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>

  <!--现金券使用规则设定表身下传 GIFT_USE_RULE_D_VENUS-->
  <migration name="GIFT_USE_RULE_D_VENUS">
    <misource class="com.emis.app.migration.emisMiRDBSource">
      <SQL>
        select s.S_NO,d.GUR_NO,d.RECNO,d.GUR_D_KIND,d.P_NO,d.P_NO_S,d.D_NO
        from GIFT_USE_RULE_D d
        inner join GIFT_USE_RULE_H h on h.GUR_NO=d.GUR_NO
        cross join vCCRStores s with(nolock)
        where h.FLS_NO = 'AP' and h.GUR_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)
          and isnull(h.GUR_S_NO,'') = '' and h.GUR_COMBINE != 20
        union all
        select s.S_NO,d.GUR_NO,d.RECNO,d.GUR_D_KIND,d.P_NO,d.P_NO_S,d.D_NO
        from GIFT_USE_RULE_D d inner join GIFT_USE_RULE_H h on h.GUR_NO=d.GUR_NO
        inner join vCCRStores s with(nolock) on charindex('/'+s.S_NO+'/','/'+h.GUR_S_NO+'/')>0
        where h.FLS_NO = 'AP' and h.GUR_DATE_E >= convert(varchar(8),dbo.GetLocalDate(),112)
          and isnull(h.GUR_S_NO,'') != '' and h.GUR_COMBINE != 20
        union all
        select s.S_NO,'ZZZZZZZZZZ' as GUR_NO,0 as RECNO,0 as GUR_D_KIND,'' as P_NO,'' as P_NO_S,'' as D_NO
        from vCCRStores s with(nolock)
        order by 1,2,3
      </SQL>
    </misource>
    <mitarget class="com.emis.app.migration.emisMiTextTarget" prefix="GIFT_USE_RULE_D."
              timestamp="yyyyMMddHHmmsss" ext="ADD.DAT" path="@\data\download" Clear="true" foridno="true"
              creationrule="com.emis.app.migration.ePosGroupCreationRule" creationkey="S_NO"/>
    <data><source name="GUR_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="RECNO"/><target length="6"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="GUR_D_KIND"/><target length="1"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="P_NO_S"/><target length="30"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="D_NO"/><target length="10"/></data>
    <data><target value="@@@" length="3"/></data>
    <data><source name="S_NO"/><target length="0"/></data>
  </migration>
</xml>