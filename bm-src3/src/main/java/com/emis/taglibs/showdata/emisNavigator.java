package com.emis.taglibs.showdata;import com.emis.file.emisFileMgr;import com.emis.trace.emisMessage;import com.emis.trace.emisTracer;import javax.servlet.ServletContext;import javax.servlet.jsp.JspWriter;import javax.servlet.jsp.tagext.TagSupport;import java.io.IOException;/** * Title: 瀏覽式物件標籤 * Description: * Copyright:    Copyright (c) 2003 * Company: * @author     emisJacky * @version 1.0 * @version 1.1 Jerry 增加span與id使外部可以參考到 */public class emisNavigator extends TagSupport{  private StringBuffer oJScript_ = new StringBuffer(1024);  private JspWriter out_ ;  private String sId_;  private String sSource_;  public int doStartTag() {    try {      String _sTableId = "idTBL" ;      sSource_ = "xmlData";      String _sClickid = "idRow" ;      emisTracer _oTrace;      ServletContext _oContext = pageContext.getServletContext();      _oTrace = emisTracer.get(_oContext);      String _sImageRoot = emisFileMgr.getInstance(_oContext).getDirectory("images").getRelative();      out_ = pageContext.getOut();      String _sGenTable = (String) pageContext.getAttribute("NAVIGATOR") ;      if (! "Y".equals( _sGenTable )){        writeTableDef(_sTableId , _sClickid );        pageContext.setAttribute("NAVIGATOR" , "Y" ) ;      }      StringBuffer _oBuf = new StringBuffer(256);      if (_sImageRoot == null) _sImageRoot = "/images/";      String _sRecord = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_RECORD);      String _sFirstRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_FIRSTREC);      String _sPrevPage = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_PREVPAGE);      String _sPrevRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_PREVREC);      String _sNextRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_NEXTREC);      String _sNextPage = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_NEXTPAGE);      String _sLastRec = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_LASTREC);      String _sMoveFR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVEFIRSTREC);      String _sMovePP = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVEPREVPAGE);      String _sMovePR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVEPREVREC);      String _sMoveNR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVENEXTREC);      String _sMoveNP = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVENEXTPAGE);      String _sMoveLR = _oTrace.getMsg(emisMessage.MSG_SHOWDATA_MOVELASTREC);      _oBuf.append("<span id='idNavigator'>");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviFirstRec\" value=\"" + _sFirstRec + "\" alt=\"" + _sFirstRec + "\" src=\"").append(_sImageRoot).append("firstrec.gif\" border=\"0\" onclick=\"NaviFirstRecFun(idTBLRec); \" TITLE=\"" + _sMoveFR + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviPrevPage\" value=\"" + _sPrevPage + "\" alt=\"" + _sPrevPage + "\" src=\"").append(_sImageRoot).append("prevpage.gif\" border=\"0\" onclick=\"NaviPrevPageFun(idTBLRec); \" TITLE=\"" + _sMovePP + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviPrevRec\"  value=\"" + _sPrevRec + "\" alt=\"" + _sPrevRec + "\" src=\"").append(_sImageRoot).append("prevrec.gif\"  border=\"0\" onclick=\"NaviPrevRecFun(idTBLRec);  \" TITLE=\"" + _sMovePR + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviNextRec\"  value=\"" + _sNextRec + "\" alt=\"" + _sNextRec + "\" src=\"").append(_sImageRoot).append("nextrec.gif\"  border=\"0\" onclick=\"NaviNextRecFun(idTBLRec);  \" TITLE=\"" + _sMoveNR + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviNextPage\" value=\"" + _sNextPage + "\" alt=\"" + _sNextPage + "\" src=\"").append(_sImageRoot).append("nextpage.gif\" border=\"0\" onclick=\"NaviNextPageFun(idTBLRec); \" TITLE=\"" + _sMoveNP + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("<IMG id=\"" + _sTableId + "NaviLastRec\"  value=\"" + _sLastRec + "\" alt=\"" + _sLastRec + "\" src=\"").append(_sImageRoot).append("lastrec.gif\"  border=\"0\" onclick=\"NaviLastRecFun(idTBLRec);  \" TITLE=\"" + _sMoveLR + _sRecord + "\" style=\"cursor:hand\">\n");      _oBuf.append("</span>");      writeln(_oBuf.toString());      if (this.oJScript_.length() > 0) {        writeln(this.oJScript_.toString());      }    } catch(Exception e){      System.out.println("NavigatorError");    }    return(SKIP_BODY);  }  private void writeTableDef(String sTableId , String sClickEventId) throws Exception {    genTableJavaScript(sTableId);    if (sClickEventId != null) {      genTableClickEvent(sClickEventId);    }  }  private void genTableClickEvent(String sClickId) throws Exception {    oJScript_.append("<script for=" + sClickId + " event=onclick>\n");    oJScript_.append("  emisOnidRowClick(this,idTBLRec);\n");    oJScript_.append("</script>");  }  private void genTableJavaScript(String sId) {    oJScript_.append("<script for=\"" + sId + "\" event=onreadystatechange>\n");    oJScript_.append("  emisOnTableReadyStateChange(idTBLRec);\n");    oJScript_.append("  </script>\n");  }  private void genTblRecJavaScript() {    oJScript_.append("<script>\n");    oJScript_.append("  var idTBLRec = { \n");    oJScript_.append("    TableId  : 'idTBL' , \n");    oJScript_.append("    TableObject : null, \n");    oJScript_.append("    MoveRecordNum : null, \n");    oJScript_.append("    dataSrc : null  }; \n");    oJScript_.append("  var idTBLcurrRowNum=null; \n ");    oJScript_.append("  var idTBLcurrRecordNum=null; \n ");    oJScript_.append("  emisSetDataSrc(idTBLRec); \n");    oJScript_.append("</script>\n");  }  private void writeln(String sStr) throws IOException {    out_.write(sStr);    out_.write("\n");  }  public String getid() {    return sId_;  }  public void setid(String sId) {    this.sId_ = sId;  }  public String getsource() {    return sSource_;  }  public void setsource(String sSource) {    this.sSource_ = sSource;  }}