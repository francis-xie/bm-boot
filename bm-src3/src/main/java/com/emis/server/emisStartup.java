package com.emis.server;import com.emis.db.emisDbConnector;import com.emis.db.emisDbMgr;import com.emis.spool.emisComplexSpool;import javax.servlet.ServletContext;/** * 在 emisServerFactory.createServer 的最後一個參數 * 為 true 時, 系統會啟動另一個 Thread 進行 emisStartup, * emisStartup 會等 Database Connector 連上資料庫後再 * 進行後續的啟動動作,所以 resin 開啟後,可能會有 * 短暫的時間是 JSP 可以用 (Servlet Engine 已啟動) * 但會有問題 (Server 物件尚未產生) */public class emisStartup implements Runnable{  private emisServer oServer_;  private ServletContext oContext_;  public emisStartup(emisServer server,ServletContext context) {    oServer_ = server;    oContext_ = context;  }  public void run() {    try {      while(true) {        emisDbMgr oDbMgr = emisDbMgr.getInstance(oContext_);        // get the default connector        emisDbConnector connector = oDbMgr.getConnector();        if( connector == null ) return; // there is no default connector        emisComplexSpool spool = (emisComplexSpool) connector;        if(spool.totalSize() > 0 )          break;        Thread.currentThread().sleep(5 * 1000);      }      oServer_.startup();    } catch (Exception err) {      err.printStackTrace();    }  }}